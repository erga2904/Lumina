<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lumina | Pro Portfolio</title>
    
    <!-- FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Figtree:ital,wght@0,300..900;1,300..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@1,400&display=swap" rel="stylesheet">
    
    <!-- ICONS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- CROPPER -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>

    <style>
        /* --- CSS VARS --- */
        :root {
            --accent-glow: #38bdf8; 
            --bg-color: #0f172a;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --glass-surface: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --input-bg: rgba(0, 0, 0, 0.3);
            --btn-bg: rgba(255,255,255,0.05);
            --accent-firebase: #fbbf24; 
            --success: #34d399;
            --error: #f87171;
            --modal-bg: #1e293b; 
        }

        :root.light-mode {
            --bg-color: #f1f5f9;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --glass-surface: rgba(255, 255, 255, 0.6);
            --glass-border: rgba(255, 255, 255, 0.8);
            --input-bg: rgba(255, 255, 255, 0.8);
            --modal-bg: #ffffff;
            --btn-bg: #e2e8f0;
        }

        body.preload * { transition: none !important; }
        html { scroll-behavior: smooth; }
        
        :root.perf-mode { --glass-surface: #1e293b; --modal-bg: #1e293b; --glass-border: #334155; }
        :root.light-mode.perf-mode { --glass-surface: #ffffff; --modal-bg: #ffffff; --glass-border: #cbd5e1; }
        body.perf-mode .ambient-light, body.perf-mode .interactive-card::before { display: none; }
        body.perf-mode .acrylic-panel, body.perf-mode .modal-content, body.perf-mode .category-badge { 
            backdrop-filter: none !important; box-shadow: none !important; 
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Figtree', sans-serif; outline: none; }
        
        body { 
            background-color: var(--bg-color); 
            color: var(--text-main); 
            overflow-x: hidden; 
            min-height: 100vh; 
            transition: background-color 0.4s ease, color 0.4s ease; 
        }
        body.no-scroll { overflow: hidden; height: 100vh; }

        /* 3D EFFECTS */
        .interactive-card { position: relative; transition: transform 0.1s ease; transform-style: preserve-3d; }
        .interactive-card::before { content:''; position: absolute; top: var(--y, 50%); left: var(--x, 50%); width: 350px; height: 350px; background: radial-gradient(circle, var(--accent-glow) 0%, transparent 60%); opacity: 0; transform: translate(-50%, -50%); transition: opacity 0.3s; pointer-events: none; mix-blend-mode: overlay; z-index: 0; }
        .interactive-card:hover::before { opacity: 0.15; }
        .interactive-card > * { position: relative; z-index: 2; }

        /* SPLASH & ANIMATION */
        #splash-screen { 
            position: fixed; top: 0; left: 0; 
            width: 100vw; height: 100vh; 
            background-color: var(--bg-color); 
            z-index: 99999; 
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
            padding: 20px; text-align: center;
            transition: opacity 0.8s ease-in-out, filter 0.8s ease-in-out, transform 0.8s ease-in-out;
        }

        #splash-screen.splash-exit {
            opacity: 0; filter: blur(20px) brightness(1.2); transform: scale(1.1); pointer-events: none;
        }

        .splash-text { font-size: 3rem; font-weight: 800; color: var(--text-main); margin-bottom: 10px; letter-spacing: -0.02em;}
        .splash-text span { display: inline-block; opacity: 0; filter: blur(10px); transform: scale(1.1); animation: blurIn 0.8s forwards ease-in-out; }
        
        .loader {
            width: 40px; height: 40px; border: 4px solid rgba(255,255,255,0.1); border-top: 4px solid var(--accent-glow);
            border-radius: 50%; animation: spin 1s linear infinite, fadeIn 0.5s forwards 1s; margin: 20px 0; opacity: 0; 
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes fadeIn { to { opacity: 1; } }

        .quote-container { 
            opacity: 0; transform: translateY(20px); 
            animation: floatUp 1s ease-out forwards; animation-delay: 0.5s; 
            max-width: 500px; padding: 20px; 
            border: 1px solid var(--glass-border); border-radius: 15px; 
            background: rgba(255,255,255,0.03); backdrop-filter: blur(10px); margin-top: 15px;
        }
        .quote-text { font-family: 'Playfair Display', serif; font-size: 1.1rem; color: var(--text-main); margin-bottom: 10px; font-style: italic; line-height: 1.4; }
        .quote-author { color: var(--accent-glow); font-size: 0.85rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; font-family: 'Figtree', sans-serif;}
        
        @keyframes blurIn { to { opacity: 1; filter: blur(0); transform: scale(1); } }
        @keyframes floatUp { to { opacity: 1; transform: translateY(0); } }

        /* PANEL */
        .acrylic-panel { background: var(--glass-surface); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid var(--glass-border); border-top: 1px solid rgba(255,255,255,0.2); box-shadow: 0 4px 30px rgba(0,0,0,0.1); border-radius: 20px; }
        .ambient-light { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }
        .orb { position: absolute; border-radius: 50%; filter: blur(80px); opacity: 0.5; animation: float 15s infinite; transition: background 0.5s; }
        .orb-1 { width: 60vw; height: 60vw; top: -10%; left: -10%; background: var(--accent-glow); }
        .orb-2 { width: 50vw; height: 50vw; bottom: 0; right: 0; background: var(--accent-glow); filter: hue-rotate(45deg) blur(80px); animation-delay: -5s; }
        @keyframes float { 0%,100%{transform:translate(0,0)} 50%{transform:translate(20px,40px)} }

        /* NAV - MOBILE OPTIMIZED */
        nav { 
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 600px; 
            padding: 12px 30px; z-index: 5000; 
            display: flex; justify-content: space-between; align-items: center; 
            border-radius: 50px; background: rgba(255,255,255,0.01); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); 
            border: 1px solid var(--glass-border); transition: top 0.3s, padding 0.3s;
        }
        nav h3 { font-weight: 800; font-size: 1.2rem; color: var(--text-main); margin: 0; letter-spacing: -0.02em; }
        nav ul { display: flex; gap: 20px; list-style: none; align-items: center; margin: 0; }
        nav a { text-decoration: none; color: var(--text-main); font-size: 0.95rem; font-weight: 600; opacity: 0.7; transition: 0.3s; cursor: pointer; position: relative;}
        nav a:hover { opacity: 1; color: var(--accent-glow); }
        #inbox-indicator { position: absolute; top: -3px; right: -8px; width: 8px; height: 8px; background: var(--error); border-radius: 50%; display: none; }

        @media (max-width: 650px) {
            nav {
                transform: translateX(-50%) !important; left: 50% !important; margin: 0 !important;
                position: fixed; top: 15px; width: 95% !important; max-width: 100%;
                padding: 10px 15px !important; border-radius: 16px !important; /* SQUARE-ISH BORDER RADIUS */
                display: flex; justify-content: space-between; align-items: center;
            }
            nav h3 { font-size: 1rem; margin-right: auto; padding-right: 10px; } /* FORCE LEFT ALIGN */
            nav ul { gap: 10px !important; }
            nav a { font-size: 0.8rem; padding: 5px; }
            
            @media (max-width: 370px) {
                nav h3 { display: none; } 
                nav { justify-content: center; } 
            }
        }

        /* HERO */
        .hero { min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 120px 0 50px; gap: 30px;}
        .hero-card { padding: 40px; width: 90%; max-width: 600px; text-align: center; }
        .profile-container { width: 140px; height: 140px; margin: 0 auto 20px; position: relative; }
        .profile-pic { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 4px solid var(--glass-border); box-shadow: 0 10px 40px rgba(0,0,0,0.2); background: #333; }
        .profile-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); border-radius: 50%; display: none; align-items: center; justify-content: center; cursor: pointer; color: #fff; font-size: 1.5rem; transition: 0.3s; }
        .profile-container:hover .profile-overlay { opacity: 1; display: flex;}
        
        #user-name { font-weight: 800; letter-spacing: -0.03em; font-size: 2.2rem; }
        #user-bio { font-size: 1.1rem; color: var(--text-muted); margin-top: 10px; font-weight: 500;}

        /* MORE INFO BTN */
        .more-info-btn { 
            background: transparent; color: var(--accent-glow); 
            border: 1px solid var(--glass-border); padding: 8px 18px; 
            border-radius: 50px; cursor: pointer; font-size: 0.8rem; 
            margin-top: 15px; font-weight: 600; transition: 0.3s; 
            display: inline-flex; align-items: center; gap: 5px;
        }
        .more-info-btn:hover { background: rgba(255,255,255,0.05); border-color: var(--accent-glow); transform: translateY(-2px); }

        .music-pill { 
            width: 100%; max-width: 400px; margin: 20px auto 0;
            background: #191414; border-radius: 12px; border: 1px solid var(--glass-border); 
            display: flex; align-items: center; justify-content: center;
            padding: 0; min-height: 82px; overflow: hidden; position: relative;
        }
        iframe.spotify-embed { border-radius: 12px; width: 100%; height: 80px; border:none; display: block; }
        .music-error-state { padding: 20px; text-align: center; color: var(--error); display: none; font-size: 0.8rem;}
        
        .tech-stack { display: flex; justify-content: center; gap: 15px; margin-top: 25px; flex-wrap: wrap; }
        .tech-item { font-size: 1.5rem; color: var(--text-muted); transition: 0.3s; position: relative; }
        .tech-item:hover { color: var(--accent-glow); transform: translateY(-3px); }
        .tech-delete { position: absolute; top: -10px; right: -10px; font-size: 0.8rem; color: var(--error); cursor: pointer; display: none; background: rgba(0,0,0,0.5); border-radius: 50%; width: 18px; height: 18px; align-items: center; justify-content: center; }

        .social-links { display: flex; gap: 15px; justify-content: center; margin-top: 15px; }
        .social-icon { color: var(--text-muted); font-size: 1.4rem; padding: 12px; background: rgba(255,255,255,0.03); border-radius: 50%; transition: 0.3s; text-decoration: none; border: 1px solid transparent; }
        .social-icon:hover { color: var(--accent-glow); background: rgba(255,255,255,0.1); transform: translateY(-3px); }

        /* GRID SYSTEM */
        section { max-width: 900px; margin: 0 auto 60px; width: 90%; scroll-margin-top: 100px; }
        .section-header { font-size: 1.6rem; font-weight: 800; letter-spacing: -0.03em; margin-bottom: 25px; border-bottom: 2px solid var(--accent-glow); padding-bottom: 5px; display: inline-block; color: var(--text-main); padding-right: 50px;}

        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-top: 20px; }
        .option-card { padding: 30px; text-align: center; cursor: pointer; transition: 0.3s; min-height: 180px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .option-card:hover .card-icon { transform: scale(1.1) rotate(5deg); color: var(--accent-glow); }
        .card-icon { font-size: 2.5rem; margin-bottom: 15px; transition: 0.3s; color: var(--text-muted); }
        .status-badge { position: absolute; top: 15px; right: 15px; font-size: 0.7rem; background: rgba(0,0,0,0.4); padding: 4px 10px; border-radius: 20px; color: #fff; font-weight: 700;}
        .card-title { font-weight: 700; font-size: 1.15rem; }

        /* APPS GRID */
        .apps-grid { display: grid; grid-template-columns: 1fr; gap: 20px; }
        .app-item { background: rgba(255,255,255,0.03); border: 1px solid var(--glass-border); border-left: 4px solid var(--accent-glow); padding: 25px; border-radius: 15px; display: flex; flex-direction: column; position: relative; }
        .app-item.hide { display: none !important; }
        .app-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;}
        .app-tag { font-size: 0.7rem; padding: 2px 8px; border-radius: 4px; background: rgba(255,255,255,0.08); text-transform: uppercase; font-weight: 700; color: var(--accent-glow); letter-spacing: 0.05em; }
        .app-name { font-size: 1.25rem; font-weight: 800; color: var(--text-main); letter-spacing: -0.01em; }
        .app-desc { font-size: 1rem; color: var(--text-muted); margin-bottom: 15px; line-height: 1.6; font-weight: 400; }
        .app-visit-btn { display: inline-block; padding: 8px 20px; border-radius: 50px; border: 1px solid var(--glass-border); color: var(--text-main); text-decoration: none; font-size: 0.95rem; align-self: flex-start; transition: 0.3s; background: rgba(255,255,255,0.05); font-weight: 600; }
        .app-visit-btn:hover { background: var(--accent-glow); border-color: var(--accent-glow); color: #fff; }
        .delete-btn { position: absolute; bottom: 20px; right: 20px; background: none; border: none; color: #ff4757; font-size: 1.2rem; cursor: pointer; display: none; }
        .app-item.editing .delete-btn { display: block; }

        /* REPO */
        .repo-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 15px; }
        .repo-card { padding: 20px; background: rgba(255,255,255,0.02); border: 1px solid var(--glass-border); border-radius: 12px; transition: 0.3s; height: 100%; display: flex; flex-direction: column; }
        .repo-card:hover { transform: translateY(-5px); border-color: var(--accent-glow); }
        .repo-name { font-weight: 700; color: var(--text-main); margin-bottom: 5px; font-size: 0.95rem; display: flex; align-items: center; gap: 8px; }
        .repo-desc { font-size: 0.9rem; color: var(--text-muted); line-height: 1.4; flex-grow: 1; margin-bottom: 15px; font-weight: 400;}
        .repo-meta { font-size: 0.75rem; color: var(--text-muted); display: flex; gap: 15px; opacity: 0.8; font-weight: 600;}
        
        .snippets-wrapper { display: flex; gap: 15px; overflow-x: auto; padding: 10px 0 20px 0; scrollbar-color: var(--glass-border) transparent; }
        .snippet-card { min-width: 280px; max-width: 300px; padding: 20px; background: rgba(255,255,255,0.02); border: 1px solid var(--glass-border); border-radius: 15px; position: relative; display: flex; flex-direction: column; justify-content: space-between; }
        .snippet-code { font-family: 'Fira Code', monospace; font-size: 0.8rem; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; margin-top: 10px; color: #a5b4fc; overflow: hidden; white-space: pre-wrap; height: 100px; }

        .guestbook-container { display: flex; flex-direction: column; gap: 20px; }
        .gb-form { display: flex; gap: 10px; flex-wrap: wrap; }
        .gb-input { flex: 1; min-width: 150px; padding: 12px 15px; border-radius: 8px; border: 1px solid var(--glass-border); background: var(--input-bg); color: var(--text-main); font-size: 0.95rem; font-family: 'Figtree', sans-serif; font-weight: 500; }
        .gb-btn { padding: 10px 20px; background: var(--accent-glow); color: #fff; border: none; border-radius: 8px; cursor: pointer; transition: 0.3s; font-weight: 700;}
        .gb-list { display: flex; flex-direction: column; gap: 10px; max-height: 300px; overflow-y: auto; margin-top: 10px; padding-right: 5px;}
        .gb-item { background: rgba(255,255,255,0.03); padding: 12px 15px; border-radius: 10px; font-size: 0.95rem; border-left: 2px solid var(--accent-glow); display: flex; justify-content: space-between; align-items: flex-start;}
        .gb-meta { font-weight: 700; color: var(--accent-glow); font-size: 0.85rem; margin-bottom: 4px; display: block;}
        .gb-text { color: var(--text-main); word-break: break-word; font-weight: 400;}
        .gb-del { color: var(--error); cursor: pointer; opacity: 0.5; font-size: 0.8rem; margin-left: 10px; }
        
        .contact-form { margin-top: 20px; display: grid; gap: 15px; }
        textarea.gb-input { height: 100px; resize: vertical; }

        /* CHANGELOG & UPDATES */
        .timeline { position: relative; margin-left: 10px; padding-left: 20px; border-left: 2px solid var(--glass-border); }
        .timeline-item { position: relative; margin-bottom: 30px; }
        .timeline-item::after { content: ''; position: absolute; left: -27px; top: 5px; width: 12px; height: 12px; background: var(--bg-color); border: 2px solid var(--accent-glow); border-radius: 50%; z-index: 2; }
        .timeline-item > div { display: flex; align-items: center; gap: 15px; margin-bottom: 6px; }
        .category-badge { font-size: 0.65rem; padding: 2px 8px; border-radius: 4px; text-transform: uppercase; font-weight: 800; border: 1px solid transparent; background: rgba(255,255,255,0.05); }
        .cat-feat { color: #34d399; border-color: #34d399; } .cat-fix { color: #f87171; border-color: #f87171; }
        .version-date { font-size: 0.8rem; color: var(--text-muted); font-weight: 700; opacity: 0.8; }
        .version-desc { font-size: 0.95rem; line-height: 1.5; font-weight: 400;}

        /* MODALS & AUTH */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.8); backdrop-filter: blur(8px); z-index: 9999; display: flex; justify-content: center; align-items: center; opacity: 0; visibility: hidden; transition: 0.3s; }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-content { background: var(--modal-bg); color: var(--text-main); width: 90%; max-width: 450px; padding: 30px; border-radius: 20px; text-align: center; border: 1px solid var(--glass-border); box-shadow: 0 25px 50px rgba(0,0,0,0.5); transform: scale(0.9); transition: transform 0.3s; position: relative; max-height: 80vh; overflow-y: auto;}
        .modal-overlay.active .modal-content { transform: scale(1); }
        .close-modal { position: absolute; top: 20px; right: 20px; cursor: pointer; font-size: 1.5rem; color: var(--text-muted); }
        
        input.login-field { width: 100%; padding: 12px; margin-bottom: 10px; background: var(--input-bg); border: 1px solid var(--glass-border); color: var(--text-main); border-radius: 8px; font-family: 'Figtree', sans-serif;}
        
        [contenteditable="true"] { border: 1px dashed var(--accent-glow); background: rgba(56, 189, 248, 0.1); padding: 0 5px; border-radius: 4px; display: inline-block; min-width: 10px;}
        [contenteditable="true"]:empty:before { content: "Edit..."; opacity: 0.5; }

        /* SETTINGS & LANG */
        .color-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; margin: 15px 0;}
        .color-swatch { width: 45px; height: 45px; border-radius: 10px; cursor: pointer; border: 2px solid transparent; transition:0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        .color-swatch:hover { transform:scale(1.1); border-color:var(--text-main); }
        
        .lang-options { display: flex; gap: 10px; margin-top: 10px; justify-content: center;}
        .lang-btn { flex: 1; padding: 8px; background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); border-radius: 8px; color: var(--text-muted); cursor: pointer; font-weight: 600; }
        .lang-btn.active { background: var(--accent-glow); color: #fff; border-color: var(--accent-glow); }

        #settings-modal .modal-content { background: #1e293b !important; color: #f8fafc !important; text-align: left; }
        .setting-action-btn { width: 100%; margin-top: 15px; padding: 12px; border: 1px solid rgba(255,255,255,0.2); border-radius: 10px; background: rgba(255,255,255,0.05); color: #fff; font-weight: 600; cursor: pointer; transition: 0.3s;}
        
        #edit-music-btn { display: none; background: transparent; color: var(--text-muted); border: 1px dashed var(--glass-border); cursor: pointer; margin-top: 8px; border-radius: 4px; padding: 4px 12px; font-size: 0.75rem; width: auto; margin-left: auto; margin-right: auto;}
        #save-about-btn { display: none; background: var(--success); color: #fff; width: 100%; margin-top: 20px; border: none; padding: 10px; border-radius: 8px; cursor: pointer; font-weight: 700; transition:0.3s;}
        
        .inbox-list { text-align: left; margin-top: 15px; }
        .msg-card { background: rgba(255,255,255,0.03); padding: 15px; border-radius: 10px; margin-bottom: 10px; border-left: 2px solid var(--accent-firebase); word-break: break-all;}
        
        .about-row { display: flex; justify-content: space-between; border-bottom: 1px solid var(--glass-border); padding: 12px 0; font-size: 0.9rem; text-align: left; }
        .about-label { color: var(--text-muted); font-weight: 500; }
        .about-value { font-weight: 700; color: var(--text-main); text-align: right;}
        .notes-section { text-align: left; margin-top: 20px; padding-top: 10px; border-top: 1px solid var(--accent-glow); }
        .notes-section h4 { font-weight: 700; color: var(--accent-glow); margin-bottom: 8px; }
        .notes-content { color: var(--text-muted); line-height: 1.6; font-size: 0.95rem; white-space: pre-wrap; }
        
        footer { padding: 40px 0; text-align: center; color: var(--text-muted); font-size: 0.9rem; border-top: 1px solid var(--glass-border); margin-top: 60px; background: var(--bg-color); z-index: 5; font-weight: 500;}
    </style>
    
    <script>
        (function() {
            try {
                document.documentElement.classList.add('preload');
                var saved = localStorage.getItem('theme');
                var sys = window.matchMedia('(prefers-color-scheme: light)').matches;
                if(saved === 'light' || (!saved && sys)) {
                    document.documentElement.classList.add('light-mode');
                }
            } catch(e) {}
        })();
    </script>
</head>
<body class="no-scroll">

    <!-- SPLASH -->
    <div id="splash-screen">
        <h1 class="splash-text"></h1>
        <div class="loader"></div>
        <div class="quote-container">
            <p id="splash-quote-text" class="quote-text"></p>
            <p id="splash-quote-author" class="quote-author"></p>
        </div>
    </div>

    <!-- ORBS -->
    <div class="ambient-light"><div class="orb orb-1"></div><div class="orb orb-2"></div></div>

    <!-- NAV -->
    <nav class="acrylic-panel">
        <h3>3RG4</h3>
        <ul>
            <li><a href="#menu-utama" id="nav-home">Home</a></li>
            <li><a href="#apps-section" id="nav-apps">Apps</a></li>
            <li><a href="#social-section"><i class="fas fa-comments"></i></a></li>
            <li><a onclick="openModal('settings-modal')" style="cursor: pointer;"><i class="fas fa-cog"></i></a></li>
            <li>
                <a href="#" onclick="handleAuthClick()">
                    <i class="fas fa-user" id="user-icon"></i>
                    <div id="inbox-indicator"></div>
                </a>
            </li>
            <li><a onclick="toggleTheme()" style="cursor: pointer;"><i class="fas fa-sun"></i></a></li>
        </ul>
    </nav>

    <!-- HERO -->
    <div class="hero">
        <div class="hero-card acrylic-panel interactive-card hidden">
            <div class="profile-container" onclick="handleProfileClick()">
                <img src="" onerror="this.src='https://ui-avatars.com/api/?name=U&background=random'" alt="Profile" class="profile-pic" id="hero-img">
                <div class="profile-overlay"><i class="fas fa-camera"></i></div>
            </div>
            
            <h1 id="user-name">User Name</h1>
            <p id="user-bio" style="font-size: 1.1rem; color: var(--text-muted); margin-top: 10px;">Web Developer</p>
            
            <button class="more-info-btn" onclick="openModal('about-modal')" id="btn-more-info">
                <i class="fas fa-info-circle"></i> More Info
            </button>

            <div class="music-pill">
                <p id="loading-music" style="color:var(--text-muted); font-size:0.8rem;">Loading Vibe...</p>
                <iframe id="spotify-embed" class="spotify-embed" style="display:none;" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
                <div id="music-error" class="music-error-state"><i class="fas fa-music"></i> Link lagu invalid</div>
            </div>
            <button id="edit-music-btn" onclick="editDailyMusic()">Ganti Lagu Manual</button>

            <div class="tech-stack" id="tech-list"></div>
            <button id="add-tech-btn" style="display:none; margin-top:10px; background:transparent; border:1px dashed var(--text-muted); color:var(--text-muted); padding:5px 10px; border-radius:5px; cursor:pointer;" onclick="addTech()">+ Icon</button>

            <div class="social-links">
                <a href="#" class="social-icon" id="link-github"><i class="fab fa-github"></i></a>
                <a href="#" class="social-icon" id="link-twitter"><i class="fa-brands fa-x-twitter"></i></a>
                <a href="#" class="social-icon" id="link-email"><i class="fas fa-envelope"></i></a>
            </div>
        </div>
    </div>

    <!-- DASHBOARD -->
    <section id="menu-utama">
        <h2 class="section-header hidden" id="label-dashboard">Dashboard</h2>
        <div class="grid">
            <div class="option-card acrylic-panel interactive-card hidden" onclick="handleAuthClick()" id="card-edit">
                <div class="status-badge" id="lock-badge"><i class="fas fa-lock"></i> Secured</div>
                <div class="card-icon"><i class="fas fa-user-shield"></i></div>
                <div class="card-title" id="title-admin">Admin Access</div>
                <div class="card-desc" id="desc-admin">Login securely</div>
            </div>
            <div class="option-card acrylic-panel interactive-card hidden" onclick="document.getElementById('apps-section').scrollIntoView()">
                <div class="card-icon"><i class="fas fa-cubes"></i></div>
                <div class="card-title" id="title-apps">My Apps</div>
                <div class="card-desc" id="desc-apps">See my work</div>
            </div>
        </div>
    </section>

    <!-- SNIPPETS -->
    <section id="snippets-section">
        <div class="acrylic-panel hidden" style="padding: 30px;">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h2 class="section-header" style="margin-bottom:0; border:none;" id="label-snippets">Code Snippets</h2>
                <button id="add-snippet-btn" onclick="addSnippet()" style="display:none; color:var(--success); background:none; border:none; font-size:1.5rem; cursor:pointer;"><i class="fas fa-plus-circle"></i></button>
            </div>
            <p style="color:var(--text-muted); font-size:0.9rem; margin-bottom:20px;">Quick solutions.</p>
            <div class="snippets-wrapper" id="snippets-list"></div>
        </div>
    </section>

    <!-- APPS GRID -->
    <section id="apps-section">
        <div class="acrylic-panel hidden" style="padding: 30px; position: relative;">
            <h2 class="section-header" id="label-my-apps">My Apps</h2>
            <i id="add-app-btn" class="fas fa-plus-circle" onclick="addApp()" style="position:absolute; top:30px; right:30px; font-size:1.8rem; color:var(--success); cursor:pointer; display:none;"></i>
            <div class="apps-grid" id="apps-list"></div>
        </div>
    </section>

    <!-- GITHUB -->
    <section id="activity-section">
        <div class="acrylic-panel hidden" style="padding: 30px;">
            <div style="display:flex; justify-content: space-between;">
                <h2 class="section-header" style="margin-bottom:20px;" id="label-repos">Recent Projects</h2>
                <i class="fas fa-cog" id="gh-config-btn" onclick="configGithub()" style="display:none; color:var(--text-muted); cursor:pointer;"></i>
            </div>
            <div id="repo-list" class="repo-grid">
                <p style="color:var(--text-muted);">Fetching repositories...</p>
            </div>
        </div>
    </section>

    <!-- GUESTBOOK & CONTACT -->
    <section id="social-section">
        <div class="grid" style="margin-top:0;">
            <div class="acrylic-panel hidden" style="padding: 30px; text-align:left;">
                <h2 class="section-header" style="font-size:1.2rem;">Guestbook <i class="fas fa-circle" style="color:var(--error); font-size:0.5rem; animation:pulse 2s infinite;"></i></h2>
                <div class="guestbook-container">
                    <div class="gb-list" id="gb-display">Loading comments...</div>
                    <div class="gb-form">
                        <input type="text" id="gb-name" class="gb-input" placeholder="Your Name" maxlength="20">
                        <input type="text" id="gb-msg" class="gb-input" placeholder="Message..." maxlength="100" style="flex:2;">
                        <button class="gb-btn" onclick="postGuestbook()"><i class="fas fa-paper-plane"></i></button>
                    </div>
                </div>
            </div>

            <div class="acrylic-panel hidden" style="padding: 30px; text-align:left;">
                <h2 class="section-header" style="font-size:1.2rem;" id="label-work">Work With Me</h2>
                <div class="contact-form">
                    <input type="text" id="c-name" class="gb-input" placeholder="Name">
                    <input type="email" id="c-email" class="gb-input" placeholder="Email">
                    <textarea id="c-msg" class="gb-input" placeholder="Project details..."></textarea>
                    <button class="gb-btn" style="width:100%;" onclick="sendMessage()" id="btn-send">Send Message</button>
                </div>
            </div>
        </div>
    </section>

    <!-- CHANGELOG -->
    <section id="changelog-section">
        <div class="acrylic-panel hidden" style="padding: 30px; position:relative;">
            <h2 class="section-header" id="label-updates">Updates</h2>
            <!-- EDIT LOG BUTTON -->
            <i id="add-log-btn" class="fas fa-plus-circle" onclick="addChangelogItem()" style="position:absolute; top:30px; right:30px; font-size:1.8rem; color:var(--success); cursor:pointer; display:none;"></i>
            <div class="timeline" id="changelog-list"></div>
        </div>
    </section>

    <footer><p>&copy; 2025 3RG4. Built with code.</p></footer>

    <!-- == MODALS == -->

    <!-- ABOUT ME -->
    <div class="modal-overlay" id="about-modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('about-modal')">&times;</span>
            <div style="text-align: center; margin-bottom: 20px;">
                <i class="fas fa-id-card" style="font-size: 3rem; color: var(--accent-glow);"></i>
                <h3 style="margin-top: 15px; font-weight: 800;" id="label-about-h">About Me</h3>
            </div>
            
            <div style="background: rgba(255,255,255,0.03); border-radius: 12px; padding: 15px;">
                <div class="about-row">
                    <span class="about-label"><i class="fas fa-signature"></i> Full Name</span>
                    <span class="about-value" id="about-fullname">Nama Lengkap</span>
                </div>
                <div class="about-row">
                    <span class="about-label"><i class="fas fa-calendar-alt"></i> Born</span>
                    <span class="about-value" id="about-birth">01 Jan 2000</span>
                </div>
                <div class="about-row">
                    <span class="about-label"><i class="fas fa-map-marker-alt"></i> Based in</span>
                    <span class="about-value" id="about-loc">Jakarta, ID</span>
                </div>
                <div class="about-row" style="border:none;">
                    <span class="about-label"><i class="fas fa-university"></i> University</span>
                    <span class="about-value" id="about-uni">Nama Kampus</span>
                </div>
            </div>
            <div class="notes-section">
                <h4><i class="fas fa-sticky-note"></i> My Notes</h4>
                <p id="about-note" class="notes-content">Hello World.</p>
            </div>
            <button id="save-about-btn" onclick="handleEditAuth(true)">
                <i class="fas fa-save"></i> SIMPAN SEMUA PERUBAHAN
            </button>
        </div>
    </div>

    <!-- MODAL AUTH DENGAN MENU LOGOUT -->
    <div class="modal-overlay" id="login-modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('login-modal')">&times;</span>
            <h3>Admin Access</h3>
            
            <!-- STATE 1: FORM LOGIN -->
            <div id="login-form-container">
                <p style="color:var(--text-muted); font-size:0.8rem; margin-bottom:15px;">Secure Firebase Login</p>
                <input type="email" id="auth-email" class="login-field" placeholder="admin@email.com">
                <input type="password" id="auth-pass" class="login-field" placeholder="Password">
                <button onclick="loginToFirebase()" class="gb-btn" style="width:100%; margin-top:10px;">
                    <i class="fas fa-sign-in-alt"></i> LOGIN
                </button>
            </div>

            <!-- STATE 2: MENU ADMIN (TERSEMBUNYI JIKA BELUM LOGIN) -->
            <div id="admin-menu-container" style="display:none;">
                <p style="color:#34d399; margin-bottom:15px; font-weight:700;"><i class="fas fa-check-circle"></i> Logged in</p>
                
                <button onclick="handleEditAuth(true)" class="gb-btn" style="width:100%; margin-bottom:10px; background:var(--accent-glow);">
                    <i class="fas fa-save"></i> SIMPAN PERUBAHAN
                </button>
                <button onclick="openModal('inbox-modal')" class="gb-btn" style="width:100%; margin-bottom:10px; background:var(--bg-color); border:1px solid var(--glass-border);">
                    <i class="fas fa-envelope"></i> BUKA INBOX
                </button>
                <button onclick="logoutFirebase()" class="gb-btn" style="width:100%; background:var(--error);">
                    <i class="fas fa-sign-out-alt"></i> LOGOUT / EXIT EDIT
                </button>
            </div>
        </div>
    </div>

    <!-- INBOX MODAL -->
    <div class="modal-overlay" id="inbox-modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('inbox-modal')">&times;</span>
            <h3>Inbox</h3>
            <div id="inbox-list" class="inbox-list">Loading...</div>
        </div>
    </div>

    <!-- SETTINGS + LANG SWITCHER -->
    <div class="modal-overlay" id="settings-modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('settings-modal')">&times;</span>
            <h3>Settings</h3>
            <div style="margin:20px 0; text-align:left;">
                <label style="font-size:0.9rem; color:var(--text-muted); display:block; margin-bottom:10px;">Accent Color</label>
                <div class="color-grid" id="accent-grid"></div>

                <!-- Bahasa / Lang -->
                <label style="font-size:0.9rem; color:var(--text-muted); display:block; margin-bottom:10px; margin-top:20px;">Language / Bahasa</label>
                <div class="lang-options">
                    <button class="lang-btn active" id="lang-id" onclick="setLanguage('id')">ID ðŸ‡®ðŸ‡©</button>
                    <button class="lang-btn" id="lang-en" onclick="setLanguage('en')">EN ðŸ‡¬ðŸ‡§</button>
                </div>
            </div>
            <button class="setting-action-btn" onclick="togglePerf()">
                <i class="fas fa-tachometer-alt"></i> Toggle Performance Mode
            </button>
        </div>
    </div>

    <!-- CROPPER -->
    <div class="modal-overlay" id="cropper-modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('cropper-modal')">&times;</span>
            <h3>Update Photo</h3>
            <input type="file" id="image-upload" accept="image/*" style="margin:20px 0;">
            <div style="height:300px; background:#000; overflow:hidden; border-radius:10px;"><img id="image-to-crop"></div>
            <button class="gb-btn" style="margin-top:15px; width:100%; background:var(--success);" onclick="applyCrop()">Save Photo</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, collection, addDoc, query, orderBy, limit, onSnapshot, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        /* --- CONFIG FIREBASE --- */
        const firebaseConfig = {
            apiKey: "AIzaSyDfpLYr8g8ltUpdV_1HuN-S_m8vnMqqtYI",
            authDomain: "lumina-portofolio.firebaseapp.com",
            projectId: "lumina-portofolio",
            storageBucket: "lumina-portofolio.firebasestorage.app",
            messagingSenderId: "797132104566",
            appId: "1:797132104566:web:a62ecbb9827dc5b0209057"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const docRef = doc(db, "users", "my-portfolio");
        let isEditing = false;
        let cropper = null;

        const quoteDB = [
            { t: "The only way to do great work is to love what you do.", a: "Steve Jobs" },
            { t: "Code is like humor. When you have to explain it, itâ€™s bad.", a: "Cory House" },
            { t: "Experience is the name everyone gives to their mistakes.", a: "Oscar Wilde" }
        ];
        const globalPlaylist = ["2IgI5W5v7bY2p8E4cW4A4h", "60ycX53i166L7q2Y1K2t1c", "6kqK3e3N3yK8aN3i6O1L8i"];

        /* --- DICTIONARY BAHASA --- */
        const translations = {
            id: {
                nav_home: "Beranda", nav_apps: "Aplikasi",
                btn_more: '<i class="fas fa-info-circle"></i> Selengkapnya',
                dash_label: "Menu Utama",
                admin_title: "Akses Admin", admin_desc: "Masuk untuk edit",
                apps_title: "Aplikasi Saya", apps_desc: "Lihat hasil karya",
                snip_label: "Kode Snippet", apps_label: "Project Saya",
                repo_label: "Project Terbaru", work_label: "Hubungi Saya",
                updates_label: "Update", send_btn: "Kirim Pesan", about_h: "Tentang Saya"
            },
            en: {
                nav_home: "Home", nav_apps: "Apps",
                btn_more: '<i class="fas fa-info-circle"></i> More Info',
                dash_label: "Dashboard",
                admin_title: "Admin Access", admin_desc: "Login securely",
                apps_title: "My Apps", apps_desc: "See my work",
                snip_label: "Code Snippets", apps_label: "My Apps",
                repo_label: "Recent Projects", work_label: "Work With Me",
                updates_label: "Updates", send_btn: "Send Message", about_h: "About Me"
            }
        };

        /* --- INIT --- */
        window.addEventListener('DOMContentLoaded', async () => {
            splashEffect();
            generateQuote();
            
            // Check Language Setting
            const savedLang = localStorage.getItem('lumina_lang') || 'en';
            setLanguage(savedLang);

            // Auth State Listener
            onAuthStateChanged(auth, (user) => {
                const loginForm = document.getElementById('login-form-container');
                const adminMenu = document.getElementById('admin-menu-container');

                if (user) {
                    // LOGIN SUCCESS (ADMIN)
                    enableEditing();
                    listenToInbox();
                    
                    if(loginForm) loginForm.style.display = 'none';
                    if(adminMenu) adminMenu.style.display = 'block';
                } else {
                    // LOGGED OUT (VISITOR)
                    disableEditing();
                    if(loginForm) loginForm.style.display = 'block';
                    if(adminMenu) adminMenu.style.display = 'none';
                }
            });

            await Promise.all([new Promise(r=>setTimeout(r,2000)), loadFromDB()]);
            removeSplash(); 
            initTheme();
            setupGuestbook();
            setupObservers();
        });

        /* --- AUTH FUNCTIONS --- */
        window.handleAuthClick = () => { openModal('login-modal'); } // Selalu buka modal, konten diatur AuthState

        window.loginToFirebase = async () => {
            const e = document.getElementById('auth-email').value;
            const p = document.getElementById('auth-pass').value;
            try {
                await signInWithEmailAndPassword(auth, e, p);
                // AuthState listener handles UI update
            } catch(error) { alert("Login Gagal: " + error.message); }
        };

        window.logoutFirebase = async () => {
            if(confirm("Logout admin?")) {
                await signOut(auth);
                window.location.reload(); // Refresh untuk membersihkan state edit visual
            }
        };

        function enableEditing() {
            isEditing = true;
            document.body.classList.add('admin-mode');
            const badge = document.getElementById('lock-badge');
            if(badge) { badge.innerHTML = '<i class="fas fa-lock-open"></i> Unlocked'; badge.style.background = '#34d399'; }
            const uIcon = document.getElementById('user-icon');
            if(uIcon) uIcon.classList.replace('fa-user', 'fa-user-astronaut');

            // Show Edit Buttons (Added Log Button)
            ['add-app-btn', 'add-tech-btn', 'add-snippet-btn', 'gh-config-btn', 'edit-music-btn', 'save-about-btn', 'add-log-btn'].forEach(id => {
                const el = document.getElementById(id); if(el) el.style.display='block';
            });
            ['user-name', 'user-bio'].forEach(id => document.getElementById(id).contentEditable = "true");
            ['about-fullname', 'about-birth', 'about-loc', 'about-uni', 'about-note'].forEach(id => {
                const el = document.getElementById(id); if(el){ el.contentEditable = "true"; el.style.borderBottom = "1px dashed var(--accent-glow)"; }
            });

            document.querySelector('.profile-overlay').style.display='flex';
            document.querySelectorAll('.delete-btn, .tech-delete, .gb-del').forEach(b => { b.style.display = 'block'; });
            document.querySelectorAll('.social-icon').forEach(l => {
                l.onclick = (e) => { e.preventDefault(); const n = prompt("Edit Link URL:", l.getAttribute('href')); if(n) l.setAttribute('href', n); };
            });
            document.querySelectorAll('.app-item').forEach(el => {
                el.classList.add('editing');
                el.querySelectorAll('.app-name, .app-desc').forEach(t => t.contentEditable="true");
            });
        }

        function disableEditing() { isEditing = false; }

        /* --- LANGUAGE LOGIC --- */
        window.setLanguage = (lang) => {
            localStorage.setItem('lumina_lang', lang);
            // Toggle active class on buttons
            document.getElementById('lang-id').classList.toggle('active', lang === 'id');
            document.getElementById('lang-en').classList.toggle('active', lang === 'en');
            
            // Apply Texts
            const t = translations[lang];
            if(t) {
                if(document.getElementById('nav-home')) document.getElementById('nav-home').innerText = t.nav_home;
                if(document.getElementById('nav-apps')) document.getElementById('nav-apps').innerText = t.nav_apps;
                if(document.getElementById('btn-more-info')) document.getElementById('btn-more-info').innerHTML = t.btn_more;
                if(document.getElementById('label-dashboard')) document.getElementById('label-dashboard').innerText = t.dash_label;
                if(document.getElementById('title-admin')) document.getElementById('title-admin').innerText = t.admin_title;
                if(document.getElementById('desc-admin')) document.getElementById('desc-admin').innerText = t.admin_desc;
                if(document.getElementById('title-apps')) document.getElementById('title-apps').innerText = t.apps_title;
                if(document.getElementById('desc-apps')) document.getElementById('desc-apps').innerText = t.apps_desc;
                if(document.getElementById('label-snippets')) document.getElementById('label-snippets').innerText = t.snip_label;
                if(document.getElementById('label-my-apps')) document.getElementById('label-my-apps').innerText = t.apps_label;
                if(document.getElementById('label-repos')) document.getElementById('label-repos').innerText = t.repo_label;
                if(document.getElementById('label-work')) document.getElementById('label-work').innerText = t.work_label;
                if(document.getElementById('btn-send')) document.getElementById('btn-send').innerText = t.send_btn;
                if(document.getElementById('label-about-h')) document.getElementById('label-about-h').innerText = t.about_h;
                if(document.getElementById('label-updates')) document.getElementById('label-updates').innerText = t.updates_label;
            }
        }

        /* --- CHANGELOG ADD --- */
        window.addChangelogItem = () => {
            if(!isEditing) return;
            const type = prompt("Tipe (feat / fix):", "feat");
            const text = prompt("Deskripsi Update:");
            if(text) {
                const d = new Date().toLocaleDateString('id-ID', { day: 'numeric', month: 'short' });
                const cls = (type && type.includes('fix')) ? 'cat-fix' : 'cat-feat';
                const tag = (type && type.includes('fix')) ? 'FIX' : 'FEAT';
                const newLog = `
                <div class="timeline-item">
                    <div><span class="category-badge ${cls}">${tag}</span><span class="version-date">${d}</span></div>
                    <p class="version-desc">${text}</p>
                </div>`;
                // Add to top
                document.getElementById('changelog-list').innerHTML = newLog + document.getElementById('changelog-list').innerHTML;
            }
        }

        /* --- LOAD & SAVE (CORE) --- */
        async function loadFromDB() {
            try {
                const snap = await getDoc(docRef);
                const data = snap.exists() ? snap.data() : {};
                
                // Safe Set Text helper
                const safeTxt = (id, val) => { if(val && document.getElementById(id)) document.getElementById(id).innerText = val; };

                safeTxt('user-name', data.name);
                safeTxt('user-bio', data.bio);
                if(data.photoBase64) document.getElementById('hero-img').src = data.photoBase64;
                if(data.themeAccent) updateAccent(data.themeAccent);
                
                if(data.aboutMe) {
                    safeTxt('about-fullname', data.aboutMe.fullname);
                    safeTxt('about-birth', data.aboutMe.birth);
                    safeTxt('about-loc', data.aboutMe.loc);
                    safeTxt('about-uni', data.aboutMe.uni);
                    safeTxt('about-note', data.aboutMe.note);
                }

                const savedManualId = data.manualSongId;
                if(savedManualId && savedManualId !== "auto" && savedManualId.length > 5) {
                    setSpotifyFrame(savedManualId);
                    document.getElementById('spotify-embed').setAttribute('data-manual-id', savedManualId);
                } else setDailyMusic(globalPlaylist); 

                const tStack = data.techStack || ['fab fa-html5', 'fab fa-js', 'fab fa-react'];
                renderTechStack(tStack);

                if(data.links) {
                    document.getElementById('link-github').href = data.links.git || '#';
                    document.getElementById('link-twitter').href = data.links.tw || '#';
                    document.getElementById('link-email').href = data.links.mail || '#';
                }

                if(data.appsHtml) {
                    const appList = document.getElementById('apps-list');
                    appList.innerHTML = data.appsHtml;
                    appList.querySelectorAll('.app-item').forEach(e => {
                        e.classList.remove('editing', 'hide'); 
                        e.querySelectorAll('[contenteditable]').forEach(c => c.removeAttribute('contenteditable'));
                        const d = e.querySelector('.delete-btn'); if(d) d.style.display='none';
                    });
                }

                if(data.snippetsHtml) document.getElementById('snippets-list').innerHTML = data.snippetsHtml;
                else renderDefaultSnippets();
                
                if(data.changelogHtml) document.getElementById('changelog-list').innerHTML = data.changelogHtml;

                const ghUser = data.ghUsername || 'erga2904';
                localStorage.setItem('gh_user', ghUser);
                loadRecentRepos(ghUser); 

                setTimeout(() => init3DTilt(), 1000);
            } catch(e) { console.error("Load Err:", e); }
        }

        window.handleEditAuth = async (isFromModal = false) => {
            if(!isEditing) { alert("Access Denied"); return; }
            if(!confirm("Simpan ke Server?")) return;
            document.body.style.cursor = 'wait';

            try {
                // CLEAN UP DOM FOR SAVING
                const appsClone = document.getElementById('apps-list').cloneNode(true);
                appsClone.querySelectorAll('.hide').forEach(e => e.classList.remove('hide'));
                appsClone.querySelectorAll('.editing').forEach(e => e.classList.remove('editing'));
                appsClone.querySelectorAll('[contenteditable]').forEach(e => e.removeAttribute('contenteditable'));
                appsClone.querySelectorAll('.delete-btn').forEach(e => e.style.display='none');

                const snipClone = document.getElementById('snippets-list').cloneNode(true);
                snipClone.querySelectorAll('[contenteditable]').forEach(e => e.removeAttribute('contenteditable'));
                
                const tStack = Array.from(document.querySelectorAll('#tech-list i')).map(el => el.className);
                const getSafeText = (id) => { const el = document.getElementById(id); return el ? el.textContent.trim() : ""; };

                const payload = {
                    name: getSafeText('user-name'),
                    bio: getSafeText('user-bio'),
                    photoBase64: document.getElementById('hero-img').src,
                    manualSongId: document.getElementById('spotify-embed').getAttribute('data-manual-id') || "auto",
                    techStack: tStack,
                    appsHtml: appsClone.innerHTML,
                    snippetsHtml: snipClone.innerHTML,
                    changelogHtml: document.getElementById('changelog-list').innerHTML,
                    ghUsername: localStorage.getItem('gh_user'),
                    themeAccent: localStorage.getItem('lumina_accent') || '#38bdf8',
                    aboutMe: {
                        fullname: getSafeText('about-fullname'),
                        birth: getSafeText('about-birth'),
                        loc: getSafeText('about-loc'),
                        uni: getSafeText('about-uni'),
                        note: getSafeText('about-note')
                    },
                    links: {
                        git: document.getElementById('link-github').getAttribute('href'),
                        tw: document.getElementById('link-twitter').getAttribute('href'),
                        mail: document.getElementById('link-email').getAttribute('href'),
                    }
                };
                
                await setDoc(docRef, payload, { merge: true });
                alert("Saved!");
                closeModal('login-modal'); // Tutup menu jika dibuka dari situ
                window.location.reload();
            } catch(e) { alert("Error: " + e.message); document.body.style.cursor = 'default'; }
        }

        /* --- STANDARD UTILS --- */
        function setDailyMusic(list) {
            const index = Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24)) % list.length;
            setSpotifyFrame(list[index]); document.getElementById('spotify-embed').setAttribute('data-manual-id', 'auto');
        }
        function getSpotifyId(input) {
            if(!input) return null;
            try {
                const regex = /track\/([a-zA-Z0-9]+)/;
                const match = input.match(regex);
                if (match && match[1]) return match[1];
                if(/^[a-zA-Z0-9]{15,30}$/.test(input)) return input;
            } catch(e) {}
            return null;
        }
        function setSpotifyFrame(id) {
            if(!id || id === 'auto') return;
            const frame = document.getElementById('spotify-embed');
            document.getElementById('loading-music').style.display='none'; document.getElementById('music-error').style.display='none';
            frame.style.display='block'; frame.src = `https://open.spotify.com/embed/track/${id}?utm_source=generator&theme=0`;
        }
        window.editDailyMusic = () => {
            if(!isEditing) return;
            const userInput = prompt("Link Spotify Lagu:");
            if(userInput === "") { setDailyMusic(globalPlaylist); alert("Mode Auto."); return; }
            if(userInput) { const validId = getSpotifyId(userInput); if(validId) { setSpotifyFrame(validId); document.getElementById('spotify-embed').setAttribute('data-manual-id', validId); } }
        }

        window.addApp=()=>{
            const n=prompt("Nama Project:"); 
            if(n){
                const d=document.createElement('div');
                d.className='app-item editing interactive-card';
                d.innerHTML=`<div class="app-header"><h4 class="app-name" contenteditable="true">${n}</h4><span class="app-tag">PROJECT</span></div><p class="app-desc" contenteditable="true">Deskripsi...</p><button class="delete-btn" style="display:block" onclick="this.parentElement.remove()"><i class="fas fa-trash"></i></button><a href="#" class="app-visit-btn" onclick="editLink(event,this)">Visit</a>`;
                document.getElementById('apps-list').prepend(d);
            }
        };
        
        window.addTech=()=>{const i=prompt("FontAwesome (fab fa-js):");if(i)document.getElementById('tech-list').innerHTML+=`<div class="tech-item"><i class="${i}"></i><span class="tech-delete" style="display:flex" onclick="this.parentElement.remove()">x</span></div>`;};
        window.addSnippet=()=>{const t=prompt("Title:");if(t)document.getElementById('snippets-list').innerHTML=`<div class="snippet-card"><h4 contenteditable="true">${t}</h4><div class="snippet-code" contenteditable="true">// code</div><span style="position:absolute;top:10px;right:10px;color:red;cursor:pointer;" onclick="this.parentElement.remove()">x</span></div>`+document.getElementById('snippets-list').innerHTML;}

        window.loadRecentRepos = async (user) => {
            try {
                const res = await fetch(`https://api.github.com/users/${user}/repos?sort=updated&per_page=6`);
                const repos = await res.json();
                const list = document.getElementById('repo-list'); list.innerHTML = '';
                if(repos.length===0){list.innerHTML='<p style="color:grey">Empty.</p>';return;}
                repos.forEach(r => {
                    list.innerHTML += `<a href="${r.html_url}" target="_blank"><div class="repo-card interactive-card"><div class="repo-name"><i class="fas fa-book-bookmark"></i> ${r.name}</div><div class="repo-desc">${r.description?r.description.substring(0,50)+'...':'No Desc'}</div><div class="repo-meta"><span>${r.language||'Code'}</span><span>â˜… ${r.stargazers_count}</span></div></div></a>`;
                });
            } catch(e) {}
        }
        window.configGithub=()=>{if(isEditing){const n=prompt("GH User:");if(n){localStorage.setItem('gh_user',n);loadRecentRepos(n);}}};
        function renderTechStack(arr) { document.getElementById('tech-list').innerHTML = arr.map(i=>`<div class="tech-item"><i class="${i.replace('<span class="tech-delete" style="display:flex" onclick="this.parentElement.remove()">x</span>','')}"></i><span class="tech-delete" onclick="this.parentElement.remove()">x</span></div>`).join(''); }
        function renderDefaultSnippets(){ document.getElementById('snippets-list').innerHTML = `<div class="snippet-card"><h4>Hello</h4><div class="snippet-code">console.log('Hi');</div></div>`; }
        window.splashEffect=()=>{ const t="Lumina";const c=document.querySelector('.splash-text');c.innerHTML=''; t.split('').forEach((s,i)=>{const n=document.createElement('span');n.innerText=s;n.style.animationDelay=i*0.1+'s';c.appendChild(n);}); }
        function removeSplash(){
            const s = document.getElementById('splash-screen'); s.classList.add('splash-exit');
            setTimeout(() => { s.style.display = 'none'; document.documentElement.classList.remove('preload'); document.body.classList.remove('preload', 'no-scroll'); }, 800); 
        }
        window.generateQuote=()=>{const r=quoteDB[Math.floor(Math.random()*quoteDB.length)];document.getElementById('splash-quote-text').innerText=`"${r.t}"`;document.getElementById('splash-quote-author').innerText=`- ${r.a}`;}
        
        window.init3DTilt=()=>{
            if(document.body.classList.contains('perf-mode')) return;
            document.querySelectorAll('.interactive-card').forEach(c=>{
                c.onmousemove=e=>{const r=c.getBoundingClientRect();c.style.transform=`perspective(1000px) rotateX(${((e.clientY-r.top-r.height/2)/r.height)*-8}deg) rotateY(${((e.clientX-r.left-r.width/2)/r.width)*8}deg) scale(1.02)`;};
                c.onmouseleave=()=>c.style.transform='perspective(1000px) rotateX(0) rotateY(0) scale(1)';
            });
        }
        
        const cols=['#38bdf8','#818cf8','#a78bfa','#f472b6','#f87171','#fb923c','#facc15','#4ade80'];
        document.getElementById('accent-grid').innerHTML=cols.map(c=>`<div class="color-swatch" style="background:${c}" onclick="updateAccent('${c}')"></div>`).join('');
        window.updateAccent=(c)=>{ document.documentElement.style.setProperty('--accent-glow',c); localStorage.setItem('lumina_accent',c); }
        window.toggleTheme=()=>{ const h=document.documentElement; h.classList.toggle('light-mode'); localStorage.setItem('theme', h.classList.contains('light-mode')?'light':'dark'); }
        window.togglePerf=()=>{const p=document.body.classList.toggle('perf-mode');localStorage.setItem('lumina_perf',p);if(!p)init3DTilt();}
        window.initTheme=()=>{
            const theme = localStorage.getItem('theme'); if(theme === 'light') document.documentElement.classList.add('light-mode');
            const accent = localStorage.getItem('lumina_accent'); if(accent) updateAccent(accent);
            if(localStorage.getItem('lumina_perf')=='true') togglePerf();
        }

        window.editLink=(e,el)=>{if(isEditing){e.preventDefault();const n=prompt("Link:",el.getAttribute('href'));if(n)el.setAttribute('href',n);}};
        window.openModal=id=>{document.getElementById(id).classList.add('active');if(id=='login-modal')setTimeout(()=>document.getElementById('auth-email').focus(),100);}
        window.closeModal=id=>document.getElementById(id).classList.remove('active');
        window.handleProfileClick=()=>{if(isEditing)openModal('cropper-modal');}
        
        window.applyCrop=()=>{if(cropper){document.getElementById('hero-img').src=cropper.getCroppedCanvas({width:300,height:300}).toDataURL('image/jpeg',0.6);closeModal('cropper-modal');}}
        document.getElementById('image-upload').addEventListener('change',e=>{if(e.target.files.length){const r=new FileReader();r.onload=v=>{document.getElementById('image-to-crop').src=v.target.result;if(cropper)cropper.destroy();cropper=new Cropper(document.getElementById('image-to-crop'),{aspectRatio:1,viewMode:1});};r.readAsDataURL(e.target.files[0]);}});
        
        function setupGuestbook() {
            const q = query(collection(db, "lumina_guestbook"), orderBy("date", "desc"), limit(10));
            onSnapshot(q, (snap) => {
                const div = document.getElementById('gb-display');
                if(snap.empty){ div.innerHTML="<p style='color:grey; text-align:center'>Belum ada pesan.</p>"; return;}
                div.innerHTML='';
                snap.forEach(d=>{
                    const dat = d.data();
                    const del = isEditing ? `<i class="fas fa-trash gb-del" style="display:inline; margin-left:10px; color:#f87171; cursor:pointer;" onclick="delGuest('${d.id}')"></i>` : '';
                    div.innerHTML+=`<div class="gb-item"><div><span class="gb-meta">${dat.name} <small style="font-weight:400; opacity:0.7;">${dat.date?new Date(dat.date.seconds*1000).toLocaleDateString():''} </small></span><span class="gb-text">${dat.msg}</span></div>${del}</div>`;
                });
            }, err => { document.getElementById('gb-display').innerHTML=`<p style='color:red; text-align:center'>...</p>`; });
        }
        
        window.postGuestbook=async()=>{const n=document.getElementById('gb-name').value;const m=document.getElementById('gb-msg').value;if(!m)return;await addDoc(collection(db,"lumina_guestbook"),{name:n||'Anon',msg:m,date:new Date()});document.getElementById('gb-msg').value='';};
        window.delGuest=async(id)=>{ if(!isEditing) return; if(confirm("Hapus?")) await deleteDoc(doc(db,"lumina_guestbook",id));};
        
        function listenToInbox(){
            if(!isEditing) return;
            const q=query(collection(db,"lumina_messages"),orderBy("date","desc"),limit(10));
            onSnapshot(q,(snap)=>{
                let h=''; let count=0;
                snap.forEach(d=>{ count++; const dat=d.data(); h+=`<div class="msg-card"><b>${dat.name}</b> (${dat.email})<br>${dat.msg}</div>`; });
                document.getElementById('inbox-list').innerHTML=h||'Kosong.';
                if(count>0) document.getElementById('inbox-indicator').style.display='block';
            });
        }
        window.sendMessage=async()=>{const n=document.getElementById('c-name').value;const e=document.getElementById('c-email').value;const m=document.getElementById('c-msg').value;if(n&&e&&m){await addDoc(collection(db,"lumina_messages"),{name:n,email:e,msg:m,date:new Date()});alert("Terkirim!");document.getElementById('c-msg').value='';} else alert("Mohon lengkapi.");};
        window.setupObservers=()=>{const o=new IntersectionObserver(e=>e.forEach(x=>{if(x.isIntersecting){x.target.classList.add('show');o.unobserve(x.target)}}),{threshold:0.1});document.querySelectorAll('.hidden').forEach(x=>o.observe(x));}
    </script>
</body>
</html>
