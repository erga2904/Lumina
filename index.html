<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lumina | Pro Portfolio</title>
    
    <!-- FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@1,400&display=swap" rel="stylesheet">
    
    <!-- ICONS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- CROPPER -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>

    <style>
        /* --- CSS VARS --- */
        :root {
            /* GLOBAL */
            --accent-glow: #38bdf8; 
            
            /* DARK MODE */
            --bg-color: #0f172a;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --glass-surface: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --input-bg: rgba(0, 0, 0, 0.3);
            --btn-bg: rgba(255,255,255,0.05);
            
            --accent-firebase: #fbbf24; 
            --success: #34d399;
            --error: #f87171;
            --modal-bg: #1e293b; 
        }

        body.light-mode {
            --bg-color: #f1f5f9;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --glass-surface: rgba(255, 255, 255, 0.6);
            --glass-border: rgba(255, 255, 255, 0.8);
            --input-bg: rgba(255, 255, 255, 0.8);
            --modal-bg: #ffffff;
            --btn-bg: #e2e8f0;
        }

        body.perf-mode { --glass-surface: #1e293b; --modal-bg: #1e293b; --glass-border: #334155; }
        body.light-mode.perf-mode { --glass-surface: #ffffff; --modal-bg: #ffffff; --glass-border: #cbd5e1; }
        body.perf-mode .ambient-light, body.perf-mode .interactive-card::before { display: none; }
        body.perf-mode .acrylic-panel, body.perf-mode .modal-content, body.perf-mode .category-badge { backdrop-filter: none !important; box-shadow: none !important; }

        html { scroll-behavior: smooth; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; outline: none; }
        body { background-color: var(--bg-color); color: var(--text-main); overflow-x: hidden; min-height: 100vh; transition: background-color 0.4s; }
        body.no-scroll { overflow: hidden; height: 100vh; }

        /* 3D & GLOW EFFECTS */
        .interactive-card { position: relative; transition: transform 0.1s ease; transform-style: preserve-3d; }
        .interactive-card::before { content:''; position: absolute; top: var(--y, 50%); left: var(--x, 50%); width: 350px; height: 350px; background: radial-gradient(circle, var(--accent-glow) 0%, transparent 60%); opacity: 0; transform: translate(-50%, -50%); transition: opacity 0.3s; pointer-events: none; mix-blend-mode: overlay; z-index: 0; }
        .interactive-card:hover::before { opacity: 0.15; }
        .interactive-card > * { position: relative; z-index: 2; }

        /* SPLASH SCREEN */
        #splash-screen { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background-color: var(--bg-color); z-index: 99999; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: opacity 0.8s ease-out, visibility 0.8s; padding: 20px; text-align: center;}
        .splash-text { font-size: 3rem; font-weight: 800; color: var(--text-main); margin-bottom: 20px; letter-spacing: -1px;}
        .splash-text span { display: inline-block; opacity: 0; filter: blur(10px); transform: scale(1.1); animation: blurIn 0.8s forwards ease-in-out; }
        .quote-container { margin-top: 30px; opacity: 0; transform: translateY(20px); animation: fadeInUp 1s forwards 0.8s; max-width: 500px; padding: 20px; border: 1px solid var(--glass-border); border-radius: 15px; background: rgba(255,255,255,0.03); backdrop-filter: blur(5px);}
        .quote-text { font-family: 'Playfair Display', serif; font-size: 1.1rem; color: var(--text-main); margin-bottom: 10px; font-style: italic;}
        .quote-author { color: var(--accent-glow); font-size: 0.8rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px;}
        
        @keyframes blurIn { to { opacity: 1; filter: blur(0); transform: scale(1); } }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }

        /* ACRYLIC PANEL */
        .acrylic-panel { background: var(--glass-surface); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid var(--glass-border); border-top: 1px solid rgba(255,255,255,0.2); box-shadow: 0 4px 30px rgba(0,0,0,0.1); border-radius: 20px; }
        .ambient-light { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }
        .orb { position: absolute; border-radius: 50%; filter: blur(80px); opacity: 0.5; animation: float 15s infinite; transition: background 0.5s; }
        .orb-1 { width: 60vw; height: 60vw; top: -10%; left: -10%; background: var(--accent-glow); }
        .orb-2 { width: 50vw; height: 50vw; bottom: 0; right: 0; background: var(--accent-glow); filter: hue-rotate(45deg) blur(80px); animation-delay: -5s; }
        @keyframes float { 0%,100%{transform:translate(0,0)} 50%{transform:translate(20px,40px)} }

        /* --- NAV DESKTOP (DEFAULT) --- */
        nav { 
            position: fixed; 
            top: 20px; 
            left: 50%; 
            transform: translateX(-50%); 
            width: 90%; 
            max-width: 600px; 
            padding: 12px 30px; /* Padding Desktop Normal */
            z-index: 5000; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            border-radius: 50px; 
            background: rgba(255,255,255,0.01); 
            backdrop-filter: blur(15px); 
            -webkit-backdrop-filter: blur(15px); 
            border: 1px solid var(--glass-border); 
            transition: all 0.3s ease;
        }
        nav h3 { font-weight: 800; font-size: 1.2rem; color: var(--text-main); margin: 0; }
        nav ul { display: flex; gap: 20px; list-style: none; align-items: center; margin: 0; }
        nav a { text-decoration: none; color: var(--text-main); font-size: 0.9rem; font-weight: 600; opacity: 0.7; transition: 0.3s; cursor: pointer; position: relative;}
        nav a:hover { opacity: 1; color: var(--accent-glow); }
        
        #inbox-indicator { position: absolute; top: -3px; right: -8px; width: 8px; height: 8px; background: var(--error); border-radius: 50%; display: none; }

        /* --- NAV MOBILE OVERRIDE --- */
        @media (max-width: 480px) {
            nav {
                width: 95%; /* Lebar dimaksimalkan ke pinggir layar */
                max-width: none;
                padding: 10px 20px; /* Header lebih tipis/kecil */
                top: 15px; /* Jarak atas dikurangi */
            }
            nav h3 {
                font-size: 1rem; /* Font nama lebih kecil */
            }
            nav ul {
                gap: 12px; /* Jarak antar ikon dirapatkan agar muat */
            }
            nav a {
                font-size: 0.8rem; /* Ukuran ikon diperkecil sedikit */
            }
        }

        /* HERO */
        .hero { min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 120px 0 50px; gap: 30px;}
        .hero-card { padding: 40px; width: 90%; max-width: 600px; text-align: center; }
        .profile-container { width: 140px; height: 140px; margin: 0 auto 20px; position: relative; }
        .profile-pic { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 4px solid var(--glass-border); box-shadow: 0 10px 40px rgba(0,0,0,0.2); background: #333; }
        .profile-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); border-radius: 50%; display: none; align-items: center; justify-content: center; cursor: pointer; color: #fff; font-size: 1.5rem; transition: 0.3s; }
        .profile-container:hover .profile-overlay { opacity: 1; display: flex;}
        
        /* MUSIC WIDGET FIX */
        .music-pill { 
            width: 100%; max-width: 400px; margin: 20px auto 0;
            background: #191414; /* Default Dark bg for Spotify frame fallback */
            border-radius: 12px; 
            border: 1px solid var(--glass-border); 
            display: flex; align-items: center; justify-content: center;
            padding: 0; min-height: 82px; /* Set exact height for iframe */
            overflow: hidden;
            position: relative;
        }
        iframe.spotify-embed { border-radius: 12px; width: 100%; height: 80px; border:none; display: block; }
        
        .music-error-state { padding: 20px; text-align: center; color: var(--error); display: none; font-size: 0.8rem;}
        .vibe-pill { display: none; }

        .tech-stack { display: flex; justify-content: center; gap: 15px; margin-top: 25px; flex-wrap: wrap; }
        .tech-item { font-size: 1.5rem; color: var(--text-muted); transition: 0.3s; position: relative; }
        .tech-item:hover { color: var(--accent-glow); transform: translateY(-3px); }
        .tech-delete { position: absolute; top: -10px; right: -10px; font-size: 0.8rem; color: var(--error); cursor: pointer; display: none; background: rgba(0,0,0,0.5); border-radius: 50%; width: 18px; height: 18px; align-items: center; justify-content: center; }

        .social-links { display: flex; gap: 15px; justify-content: center; margin-top: 15px; }
        .social-icon { color: var(--text-muted); font-size: 1.4rem; padding: 12px; background: rgba(255,255,255,0.03); border-radius: 50%; transition: 0.3s; text-decoration: none; border: 1px solid transparent; }
        .social-icon:hover { color: var(--accent-glow); background: rgba(255,255,255,0.1); transform: translateY(-3px); }

        /* SECTIONS */
        section { max-width: 900px; margin: 0 auto 60px; width: 90%; scroll-margin-top: 100px; }
        .section-header { font-size: 1.5rem; font-weight: 700; margin-bottom: 25px; border-bottom: 2px solid var(--accent-glow); padding-bottom: 5px; display: inline-block; color: var(--text-main); position: relative; padding-right: 50px;}

        /* CARDS & GRID */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-top: 20px; }
        .option-card { padding: 30px; text-align: center; cursor: pointer; transition: 0.3s; min-height: 180px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .option-card:hover .card-icon { transform: scale(1.1) rotate(5deg); color: var(--accent-glow); }
        .card-icon { font-size: 2.5rem; margin-bottom: 15px; transition: 0.3s; color: var(--text-muted); }
        .status-badge { position: absolute; top: 15px; right: 15px; font-size: 0.7rem; background: rgba(0,0,0,0.4); padding: 4px 10px; border-radius: 20px; color: #fff; }

        .filter-container { display: flex; gap: 10px; margin-bottom: 25px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none; }
        .filter-btn { padding: 6px 16px; border-radius: 20px; border: 1px solid var(--glass-border); background: rgba(255,255,255,0.03); color: var(--text-muted); cursor: pointer; font-size: 0.85rem; transition: 0.3s; white-space: nowrap; }
        .filter-btn.active, .filter-btn:hover { background: var(--accent-glow); border-color: var(--accent-glow); color: #fff; }

        .apps-grid { display: grid; grid-template-columns: 1fr; gap: 20px; }
        .app-item { background: rgba(255,255,255,0.03); border: 1px solid var(--glass-border); border-left: 4px solid var(--accent-glow); padding: 25px; border-radius: 15px; display: flex; flex-direction: column; position: relative; }
        .app-item.hide { display: none; }
        .app-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;}
        .app-tag { font-size: 0.7rem; padding: 2px 8px; border-radius: 4px; background: rgba(255,255,255,0.08); text-transform: uppercase; font-weight: 600; color: var(--accent-glow); }
        .app-name { font-size: 1.2rem; font-weight: 700; color: var(--text-main); }
        .app-desc { font-size: 0.95rem; color: var(--text-muted); margin-bottom: 15px; line-height: 1.6; }
        .app-visit-btn { display: inline-block; padding: 8px 20px; border-radius: 50px; border: 1px solid var(--glass-border); color: var(--text-main); text-decoration: none; font-size: 0.9rem; align-self: flex-start; transition: 0.3s; background: rgba(255,255,255,0.05); }
        .app-visit-btn:hover { background: var(--accent-glow); border-color: var(--accent-glow); color: #fff; }
        .delete-btn { position: absolute; bottom: 20px; right: 20px; background: none; border: none; color: #ff4757; font-size: 1.2rem; cursor: pointer; display: none; }
        .app-item.editing .delete-btn { display: block; }

        /* REPO GRID (NEW) */
        .repo-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 15px; }
        .repo-card { padding: 20px; background: rgba(255,255,255,0.02); border: 1px solid var(--glass-border); border-radius: 12px; transition: 0.3s; height: 100%; display: flex; flex-direction: column; }
        .repo-card:hover { transform: translateY(-5px); border-color: var(--accent-glow); }
        .repo-name { font-weight: 700; color: var(--text-main); margin-bottom: 5px; font-size: 0.95rem; display: flex; align-items: center; gap: 8px; }
        .repo-desc { font-size: 0.85rem; color: var(--text-muted); line-height: 1.4; flex-grow: 1; margin-bottom: 15px;}
        .repo-meta { font-size: 0.75rem; color: var(--text-muted); display: flex; gap: 15px; opacity: 0.8; }
        
        /* SNIPPETS */
        .snippets-wrapper { display: flex; gap: 15px; overflow-x: auto; padding: 10px 0 20px 0; scrollbar-color: var(--glass-border) transparent; }
        .snippet-card { min-width: 280px; max-width: 300px; padding: 20px; background: rgba(255,255,255,0.02); border: 1px solid var(--glass-border); border-radius: 15px; position: relative; display: flex; flex-direction: column; justify-content: space-between; }
        .snippet-code { font-family: 'Fira Code', monospace; font-size: 0.8rem; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; margin-top: 10px; color: #a5b4fc; overflow: hidden; white-space: pre-wrap; height: 100px; }

        /* GUESTBOOK & CONTACT */
        .guestbook-container { display: flex; flex-direction: column; gap: 20px; }
        .gb-form { display: flex; gap: 10px; flex-wrap: wrap; }
        .gb-input { flex: 1; min-width: 150px; padding: 10px 15px; border-radius: 8px; border: 1px solid var(--glass-border); background: var(--input-bg); color: var(--text-main); font-size: 0.9rem; }
        .gb-btn { padding: 10px 20px; background: var(--accent-glow); color: #fff; border: none; border-radius: 8px; cursor: pointer; transition: 0.3s; font-weight: 600;}
        .gb-btn:hover { box-shadow: 0 0 15px var(--accent-glow); }
        .gb-list { display: flex; flex-direction: column; gap: 10px; max-height: 300px; overflow-y: auto; margin-top: 10px; padding-right: 5px;}
        .gb-item { background: rgba(255,255,255,0.03); padding: 12px 15px; border-radius: 10px; font-size: 0.9rem; border-left: 2px solid var(--accent-glow); display: flex; justify-content: space-between; align-items: flex-start;}
        .gb-meta { font-weight: 700; color: var(--accent-glow); font-size: 0.8rem; margin-bottom: 4px; display: block;}
        .gb-text { color: var(--text-main); word-break: break-word;}
        .gb-del { color: var(--error); cursor: pointer; opacity: 0.5; font-size: 0.8rem; margin-left: 10px; }
        
        .contact-form { margin-top: 20px; display: grid; gap: 15px; }
        textarea.gb-input { height: 100px; resize: vertical; }

        /* CHANGELOG - Versionless */
        .timeline { position: relative; margin-left: 10px; padding-left: 20px; border-left: 2px solid var(--glass-border); }
        .timeline-item { position: relative; margin-bottom: 30px; }
        .timeline-item::after { content: ''; position: absolute; left: -27px; top: 5px; width: 12px; height: 12px; background: var(--bg-color); border: 2px solid var(--accent-glow); border-radius: 50%; z-index: 2; }
        .timeline-item > div { display: flex; align-items: center; gap: 15px; margin-bottom: 6px; }
        .category-badge { font-size: 0.65rem; padding: 2px 8px; border-radius: 4px; text-transform: uppercase; font-weight: 800; border: 1px solid transparent; background: rgba(255,255,255,0.05); }
        .cat-feat { color: #34d399; border-color: #34d399; } .cat-fix { color: #f87171; border-color: #f87171; }
        .version-date { font-size: 0.75rem; color: var(--text-muted); font-weight: 600; opacity: 0.8; }
        .version-desc { font-size: 0.9rem; line-height: 1.5; }

        /* MODALS & SETTINGS */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.8); backdrop-filter: blur(8px); z-index: 9999; display: flex; justify-content: center; align-items: center; opacity: 0; visibility: hidden; transition: 0.3s; }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-content { background: var(--modal-bg); color: var(--text-main); width: 90%; max-width: 450px; padding: 30px; border-radius: 20px; text-align: center; border: 1px solid var(--glass-border); box-shadow: 0 25px 50px rgba(0,0,0,0.5); transform: scale(0.9); transition: transform 0.3s; position: relative; max-height: 80vh; overflow-y: auto;}
        .modal-overlay.active .modal-content { transform: scale(1); }
        .close-modal { position: absolute; top: 20px; right: 20px; cursor: pointer; font-size: 1.5rem; color: var(--text-muted); }
        input.pin-field { width: 100%; padding: 15px; font-size: 2rem; text-align: center; margin: 20px 0; background: var(--input-bg); border: 1px solid var(--glass-border); color: var(--text-main); border-radius: 12px; letter-spacing: 8px; }
        [contenteditable="true"] { border: 1px dashed var(--accent-glow); background: rgba(56, 189, 248, 0.1); padding: 0 5px; border-radius: 4px; display: inline-block; min-width: 10px;}

        /* SETTINGS STYLE FIXES */
        .color-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; margin: 15px 0;}
        .color-swatch { width: 45px; height: 45px; border-radius: 10px; cursor: pointer; border: 2px solid transparent; transition:0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        .color-swatch:hover { transform:scale(1.1); border-color:var(--text-main); }
        
        #settings-modal .modal-content { background: #1e293b !important; color: #f8fafc !important; text-align: left; }
        #settings-modal h3 { text-align: center; margin-bottom: 20px; }
        .setting-action-btn { 
            width: 100%; margin-top: 15px; padding: 12px; 
            border: 1px solid rgba(255,255,255,0.2); 
            border-radius: 10px; 
            background: rgba(255,255,255,0.05); 
            color: #fff;
            font-weight: 600; cursor: pointer; transition: 0.3s;
        }
        .setting-action-btn:hover { border-color: var(--accent-glow); background: rgba(255,255,255,0.1); }
        
        /* EDIT MUSIC BTN */
        #edit-music-btn { display: none; background: transparent; color: var(--text-muted); border: 1px dashed var(--glass-border); cursor: pointer; margin-top: 8px; border-radius: 4px; padding: 4px 12px; font-size: 0.7rem; width: auto; margin-left: auto; margin-right: auto;}
        #edit-music-btn:hover { border-color: var(--accent-glow); color: var(--text-main); }

        .inbox-list { text-align: left; margin-top: 15px; }
        .msg-card { background: rgba(255,255,255,0.03); padding: 15px; border-radius: 10px; margin-bottom: 10px; border-left: 2px solid var(--accent-firebase); }

        footer { padding: 40px 0; text-align: center; color: var(--text-muted); font-size: 0.9rem; border-top: 1px solid var(--glass-border); margin-top: 60px; background: var(--bg-color); z-index: 5; }
    </style>
</head>
<body class="no-scroll">

    <!-- Splash Screen -->
    <div id="splash-screen">
        <h1 class="splash-text"></h1>
        <div class="quote-container">
            <p id="splash-quote-text" class="quote-text"></p>
            <p id="splash-quote-author" class="quote-author"></p>
        </div>
    </div>

    <!-- Background Ambience -->
    <div class="ambient-light"><div class="orb orb-1"></div><div class="orb orb-2"></div></div>

    <!-- Navigation -->
    <nav class="acrylic-panel">
        <h3>Lumina</h3>
        <ul>
            <li><a href="#menu-utama">Home</a></li>
            <li><a href="#apps-section">Apps</a></li>
            <li><a href="#social-section"><i class="fas fa-comments"></i></a></li>
            <li><a onclick="openModal('settings-modal')" style="cursor: pointer;"><i class="fas fa-cog"></i></a></li>
            <li>
                <a href="#" onclick="handleAuthClick()">
                    <i class="fas fa-user" id="user-icon"></i>
                    <div id="inbox-indicator"></div>
                </a>
            </li>
            <li><a onclick="toggleTheme()" style="cursor: pointer;"><i class="fas fa-sun"></i></a></li>
        </ul>
    </nav>

    <!-- HERO -->
    <div class="hero">
        <div class="hero-card acrylic-panel interactive-card hidden">
            <!-- Profile -->
            <div class="profile-container" onclick="handleProfileClick()">
                <img src="" onerror="this.src='https://ui-avatars.com/api/?name=U&background=random'" alt="Profile" class="profile-pic" id="hero-img">
                <div class="profile-overlay"><i class="fas fa-camera"></i></div>
            </div>
            
            <h1 id="user-name">User Name</h1>
            <p id="user-bio" style="font-size: 1.1rem; color: var(--text-muted); margin-top: 10px;">Web Developer</p>
            
            <!-- DAILY MUSIC RECOMMENDATION (Spotify Embed Fix) -->
            <div class="music-pill">
                <p id="loading-music" style="color:var(--text-muted); font-size:0.8rem;">Loading Vibe...</p>
                <!-- Iframe defaultnya kosong, diisi oleh JS -->
                <iframe id="spotify-embed" class="spotify-embed" style="display:none;" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
                <div id="music-error" class="music-error-state"><i class="fas fa-music"></i> Link lagu invalid</div>
            </div>
            <button id="edit-music-btn" onclick="editDailyMusic()">Ganti Lagu Manual</button>

            <!-- TECH STACK -->
            <div class="tech-stack" id="tech-list">
                <!-- Injected via JS -->
            </div>
            <button id="add-tech-btn" style="display:none; margin-top:10px; background:transparent; border:1px dashed var(--text-muted); color:var(--text-muted); padding:5px 10px; border-radius:5px; cursor:pointer;" onclick="addTech()">+ Icon</button>

            <!-- Links -->
            <div class="social-links">
                <a href="#" class="social-icon" id="link-github"><i class="fab fa-github"></i></a>
                <a href="#" class="social-icon" id="link-twitter"><i class="fa-brands fa-x-twitter"></i></a>
                <a href="#" class="social-icon" id="link-email"><i class="fas fa-envelope"></i></a>
            </div>
        </div>
    </div>

    <!-- DASHBOARD -->
    <section id="menu-utama">
        <h2 class="section-header hidden">Dashboard</h2>
        <div class="grid">
            <div class="option-card acrylic-panel interactive-card hidden" onclick="handleEditAuth()" id="card-edit">
                <div class="status-badge" id="lock-badge"><i class="fas fa-lock"></i> Locked</div>
                <div class="card-icon"><i class="fas fa-user-cog"></i></div>
                <div class="card-title">Edit Profile</div>
                <div class="card-desc">Login to manage content</div>
            </div>
            <div class="option-card acrylic-panel interactive-card hidden" onclick="document.getElementById('apps-section').scrollIntoView()">
                <div class="card-icon"><i class="fas fa-cubes"></i></div>
                <div class="card-title">Portfolio</div>
                <div class="card-desc">See my work</div>
            </div>
        </div>
    </section>

    <!-- SNIPPETS -->
    <section id="snippets-section">
        <div class="acrylic-panel hidden" style="padding: 30px;">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h2 class="section-header" style="margin-bottom:0; border:none;">Code Snippets</h2>
                <button id="add-snippet-btn" onclick="addSnippet()" style="display:none; color:var(--success); background:none; border:none; font-size:1.5rem; cursor:pointer;"><i class="fas fa-plus-circle"></i></button>
            </div>
            <p style="color:var(--text-muted); font-size:0.9rem; margin-bottom:20px;">Quick solutions.</p>
            <div class="snippets-wrapper" id="snippets-list"></div>
        </div>
    </section>

    <!-- PROJECTS -->
    <section id="apps-section">
        <div class="acrylic-panel hidden" style="padding: 30px; position: relative;">
            <h2 class="section-header">Portfolio</h2>
            <i id="add-app-btn" class="fas fa-plus-circle" onclick="addApp()" style="position:absolute; top:30px; right:30px; font-size:1.8rem; color:var(--success); cursor:pointer; display:none;"></i>
            
            <div class="filter-container">
                <button class="filter-btn active" onclick="filterApps('all', this)">All</button>
                <button class="filter-btn" onclick="filterApps('web', this)">Web</button>
                <button class="filter-btn" onclick="filterApps('mobile', this)">Mobile</button>
                <button class="filter-btn" onclick="filterApps('ui', this)">UI/UX</button>
            </div>

            <div class="apps-grid" id="apps-list"></div>
        </div>
    </section>

    <!-- RECENT PROJECTS (GITHUB) -->
    <section id="activity-section">
        <div class="acrylic-panel hidden" style="padding: 30px;">
            <div style="display:flex; justify-content: space-between;">
                <h2 class="section-header" style="margin-bottom:20px;">Recent Projects</h2>
                <i class="fas fa-cog" id="gh-config-btn" onclick="configGithub()" style="display:none; color:var(--text-muted); cursor:pointer;"></i>
            </div>
            <div id="repo-list" class="repo-grid">
                <p style="color:var(--text-muted);">Fetching repositories...</p>
            </div>
        </div>
    </section>

    <!-- SOCIAL & GUESTBOOK -->
    <section id="social-section">
        <div class="grid" style="margin-top:0;">
            <!-- GUESTBOOK -->
            <div class="acrylic-panel hidden" style="padding: 30px; text-align:left;">
                <h2 class="section-header" style="font-size:1.2rem;">Guestbook <i class="fas fa-circle" style="color:var(--error); font-size:0.5rem; animation:pulse 2s infinite;"></i></h2>
                <div class="guestbook-container">
                    <div class="gb-list" id="gb-display">Loading comments...</div>
                    <div class="gb-form">
                        <input type="text" id="gb-name" class="gb-input" placeholder="Your Name" maxlength="20">
                        <input type="text" id="gb-msg" class="gb-input" placeholder="Message..." maxlength="60" style="flex:2;">
                        <button class="gb-btn" onclick="postGuestbook()"><i class="fas fa-paper-plane"></i></button>
                    </div>
                </div>
            </div>

            <!-- CONTACT -->
            <div class="acrylic-panel hidden" style="padding: 30px; text-align:left;">
                <h2 class="section-header" style="font-size:1.2rem;">Work With Me</h2>
                <div class="contact-form">
                    <input type="text" id="c-name" class="gb-input" placeholder="Name">
                    <input type="email" id="c-email" class="gb-input" placeholder="Email">
                    <textarea id="c-msg" class="gb-input" placeholder="Project details..."></textarea>
                    <button class="gb-btn" style="width:100%;" onclick="sendMessage()">Send Message</button>
                </div>
            </div>
        </div>
    </section>

    <!-- CHANGELOG -->
    <section id="changelog-section">
        <div class="acrylic-panel hidden" style="padding: 30px;">
            <h2 class="section-header">Updates</h2>
            <div class="timeline" id="changelog-list"></div>
        </div>
    </section>

    <footer><p>&copy; 2025 Lumina. Built with code.</p></footer>

    <!-- MODALS -->
    <!-- Login Modal -->
    <div class="modal-overlay" id="login-modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('login-modal')">&times;</span>
            <h3>Admin Access</h3>
            <input type="password" id="pin-input" class="pin-field" placeholder="••••" maxlength="4" inputmode="numeric">
            <button onclick="checkPin()" class="gb-btn" style="width:100%; margin-top:10px;">UNLOCK</button>
        </div>
    </div>

    <!-- Inbox Modal -->
    <div class="modal-overlay" id="inbox-modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('inbox-modal')">&times;</span>
            <h3>Inbox</h3>
            <div id="inbox-list" class="inbox-list">Loading...</div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal-overlay" id="settings-modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('settings-modal')">&times;</span>
            <h3>Settings</h3>
            <div style="margin:20px 0; text-align:left;">
                <label style="font-size:0.9rem; color:var(--text-muted); display:block; margin-bottom:10px;">Accent Color</label>
                <div class="color-grid" id="accent-grid"></div>
            </div>
            
            <button class="setting-action-btn" onclick="togglePerf()">
                <i class="fas fa-tachometer-alt"></i> Toggle Performance Mode
            </button>
        </div>
    </div>

    <!-- Cropper Modal -->
    <div class="modal-overlay" id="cropper-modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('cropper-modal')">&times;</span>
            <h3>Update Photo</h3>
            <input type="file" id="image-upload" accept="image/*" style="margin:20px 0;">
            <div style="height:300px; background:#000; overflow:hidden; border-radius:10px;"><img id="image-to-crop"></div>
            <button class="gb-btn" style="margin-top:15px; width:100%; background:var(--success);" onclick="applyCrop()">Save Photo</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, collection, addDoc, query, orderBy, limit, onSnapshot, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        /* --- CONFIG FIREBASE (WAJIB DIGANTI!) --- */
        // Masukkan data dari Firebase Console -> Project Settings
        const firebaseConfig = {
  apiKey: "AIzaSyDfpLYr8g8ltUpdV_1HuN-S_m8vnMqqtYI",
  authDomain: "lumina-portofolio.firebaseapp.com",
  projectId: "lumina-portofolio",
  storageBucket: "lumina-portofolio.firebasestorage.app",
  messagingSenderId: "797132104566",
  appId: "1:797132104566:web:a62ecbb9827dc5b0209057"
};
        
        const ADMIN_PIN = "2908"; 

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const docRef = doc(db, "users", "my-portfolio");
        let isEditing = false;
        let cropper = null;

        const quoteDB = [
            { t: "The only way to do great work is to love what you do.", a: "Steve Jobs" },
            { t: "Simplicity is the ultimate sophistication.", a: "Leonardo da Vinci" },
            { t: "Code is like humor. When you have to explain it, it’s bad.", a: "Cory House" },
            { t: "Experience is the name everyone gives to their mistakes.", a: "Oscar Wilde" }
        ];

        /* --- DAILY MUSIC AUTO PLAYLIST --- */
        const globalPlaylist = [
            "2IgI5W5v7bY2p8E4cW4A4h", // Hati-Hati di Jalan
            "60ycX53i166L7q2Y1K2t1c", // Golden Hour
            "6kqK3e3N3yK8aN3i6O1L8i", // Glimpse of Us
            "1xziMcdG4K5w7yG1w1P5a4", // As It Was
            "5K4gC0qV3iC3w3i7m4K3g3", // Komang
            "4Dvkj6JhhA12DmsUUkilzx"  // Seven
        ];

        /* --- STARTUP --- */
        window.addEventListener('DOMContentLoaded', () => {
            splashEffect();
            generateQuote();
            loadFromDB(); 
            initTheme();
            setupGuestbook();
            setupObservers();
        });

        /* --- LOAD DATA --- */
        async function loadFromDB() {
            try {
                const snap = await getDoc(docRef);
                const data = snap.exists() ? snap.data() : {};

                if(data.name) document.getElementById('user-name').innerText = data.name;
                if(data.bio) document.getElementById('user-bio').innerText = data.bio;
                if(data.photoBase64) document.getElementById('hero-img').src = data.photoBase64;
                if(data.themeAccent) updateAccent(data.themeAccent);
                
                // --- MUSIC LOGIC FIXED ---
                const savedManualId = data.manualSongId;
                // Pastikan "manualSongId" yang ada bukan undefined
                if(savedManualId && savedManualId !== "auto" && savedManualId.length > 5) {
                    setSpotifyFrame(savedManualId);
                    document.getElementById('spotify-embed').setAttribute('data-manual-id', savedManualId);
                } else {
                    setDailyMusic(globalPlaylist); // Auto
                }

                const tStack = data.techStack || ['fab fa-html5', 'fab fa-js', 'fab fa-react'];
                renderTechStack(tStack);

                if(data.links) {
                    document.getElementById('link-github').href = data.links.git || '#';
                    document.getElementById('link-twitter').href = data.links.tw || '#';
                    document.getElementById('link-email').href = data.links.mail || '#';
                }

                if(data.appsHtml) {
                    document.getElementById('apps-list').innerHTML = data.appsHtml;
                    document.querySelectorAll('#apps-list [contenteditable]').forEach(e => e.removeAttribute('contenteditable'));
                    document.querySelectorAll('#apps-list .delete-btn').forEach(e => e.style.display = 'none');
                    document.querySelectorAll('#apps-list .app-item').forEach(e => e.classList.remove('editing'));
                }

                if(data.snippetsHtml) document.getElementById('snippets-list').innerHTML = data.snippetsHtml;
                else renderDefaultSnippets();
                
                if(data.changelogHtml) document.getElementById('changelog-list').innerHTML = data.changelogHtml;

                const ghUser = data.ghUsername || 'erga2904';
                localStorage.setItem('gh_user', ghUser);
                loadRecentRepos(ghUser); 

                setTimeout(() => init3DTilt(), 1000);

            } catch(e) { 
                console.error("Load Error:", e);
                if(e.code === 'permission-denied') {
                    alert("Akses Database Ditolak! Harap cek Firestore Rules.");
                }
            }
        }

        /* --- LOGIC AUTH & SAVE --- */
        window.checkPin = () => {
            if(document.getElementById('pin-input').value === ADMIN_PIN) {
                closeModal('login-modal');
                enableEditing();
                listenToInbox();
            } else alert("PIN Salah!");
        };

        function enableEditing() {
            isEditing = true;
            document.body.classList.add('admin-mode');
            document.getElementById('lock-badge').innerHTML = '<i class="fas fa-unlock"></i> Unlocked';
            document.getElementById('lock-badge').style.background = '#34d399';
            document.getElementById('lock-badge').style.color = '#fff';
            document.getElementById('user-icon').classList.replace('fa-user', 'fa-user-astronaut');

            ['add-app-btn', 'add-tech-btn', 'add-snippet-btn', 'gh-config-btn', 'edit-music-btn'].forEach(id => {
                const el = document.getElementById(id); if(el) el.style.display='block';
            });
            ['user-name', 'user-bio'].forEach(id => document.getElementById(id).contentEditable = "true");

            document.querySelector('.profile-overlay').style.display='flex';
            const trashIcons = document.querySelectorAll('.delete-btn, .tech-delete, .gb-del');
            trashIcons.forEach(b => b.style.display='block');

            document.querySelectorAll('.social-icon').forEach(l => {
                l.onclick = (e) => { 
                    e.preventDefault(); 
                    const n = prompt("Edit Link URL:", l.getAttribute('href')); 
                    if(n) l.setAttribute('href', n); 
                };
            });

            document.querySelectorAll('.app-item').forEach(el => {
                el.classList.add('editing');
                el.querySelectorAll('.app-name, .app-desc').forEach(t => t.contentEditable="true");
            });
        }

        window.handleAuthClick = () => { if(isEditing) openModal('inbox-modal'); else openModal('login-modal'); }

        // SAVE FUNCTION
        window.handleEditAuth = async () => {
            if(!isEditing) { openModal('login-modal'); return; }

            if(confirm("Tambah Log Update?")) {
                const type = prompt("Tipe (fitur / fix)?", "fitur");
                const text = prompt("Deskripsi:");
                if(text) {
                    const d = new Date().toLocaleDateString('id-ID', { day: 'numeric', month: 'short' });
                    const cls = (type && type.includes('fix')) ? 'cat-fix' : 'cat-feat';
                    const tagLabel = type ? type.toUpperCase() : 'UPDATE';
                    const newLogHTML = `<div class="timeline-item"><div><span class="category-badge ${cls}">${tagLabel}</span><span class="version-date">${d}</span></div><p class="version-desc">${text}</p></div>`;
                    const logContainer = document.getElementById('changelog-list');
                    logContainer.innerHTML = newLogHTML + logContainer.innerHTML;
                }
            }

            if(!confirm("Simpan ke Server?")) return;
            document.body.style.cursor = 'wait';

            try {
                const tStack = Array.from(document.querySelectorAll('#tech-list i')).map(el => el.className);
                
                const appsClone = document.getElementById('apps-list').cloneNode(true);
                appsClone.querySelectorAll('[contenteditable]').forEach(e => e.removeAttribute('contenteditable'));
                appsClone.querySelectorAll('.delete-btn').forEach(e => e.style.display='none');
                appsClone.querySelectorAll('.app-item').forEach(e => e.classList.remove('editing'));

                const snipClone = document.getElementById('snippets-list').cloneNode(true);
                snipClone.querySelectorAll('[contenteditable]').forEach(e => e.removeAttribute('contenteditable'));
                
                // Get Music Data - Keep current attribute unless explicit change
                const manualMusicEl = document.getElementById('spotify-embed');
                const manualIdToSave = manualMusicEl.getAttribute('data-manual-id') || "auto";

                const payload = {
                    name: document.getElementById('user-name').innerText,
                    bio: document.getElementById('user-bio').innerText,
                    photoBase64: document.getElementById('hero-img').src,
                    manualSongId: manualIdToSave,
                    techStack: tStack,
                    appsHtml: appsClone.innerHTML,
                    snippetsHtml: snipClone.innerHTML,
                    changelogHtml: document.getElementById('changelog-list').innerHTML,
                    ghUsername: localStorage.getItem('gh_user'),
                    themeAccent: localStorage.getItem('lumina_accent') || '#38bdf8',
                    links: {
                        git: document.getElementById('link-github').getAttribute('href'),
                        tw: document.getElementById('link-twitter').getAttribute('href'),
                        mail: document.getElementById('link-email').getAttribute('href'),
                    }
                };
                
                const jsonStr = JSON.stringify(payload);
                const sizeInMB = new Blob([jsonStr]).size / (1024 * 1024);
                if(sizeInMB > 0.95) throw new Error("Ukuran data > 1MB. Kecilkan foto profil.");

                await setDoc(docRef, payload, { merge: true });
                alert("Berhasil disimpan!");
                window.location.reload();

            } catch(e) {
                console.error("Save Error:", e);
                alert("Gagal: " + e.message);
                document.body.style.cursor = 'default';
            }
        }

        /* --- FEATURE: SMART MUSIC EDIT --- */
        function setDailyMusic(list) {
            const now = new Date();
            const start = new Date(now.getFullYear(), 0, 0);
            const diff = now - start;
            const oneDay = 1000 * 60 * 60 * 24;
            const dayOfYear = Math.floor(diff / oneDay);
            const index = dayOfYear % list.length;
            const id = list[index];
            setSpotifyFrame(id);
            // "auto" means no manual override in save
            document.getElementById('spotify-embed').setAttribute('data-manual-id', 'auto');
        }

        // --- NEW: ROBUST SPOTIFY PARSER (FIX FOR INTL LINKS) ---
        function getSpotifyId(input) {
            if(!input) return null;
            try {
                // Method 1: Regex mencari pola 'track/' di tengah URL apa saja
                // Ini mengatasi https://open.spotify.com/intl-id/track/ID?si=...
                // Dan juga https://open.spotify.com/track/ID...
                const regex = /track\/([a-zA-Z0-9]+)/;
                const match = input.match(regex);
                if (match && match[1]) return match[1];

                // Method 2: Cek apakah input hanya ID saja (Alphanumeric 15-30 chars)
                // ID spotify biasanya 22 karakter
                if(/^[a-zA-Z0-9]{15,30}$/.test(input)) return input;
                
            } catch(e) { console.error(e); }
            return null;
        }

        function setSpotifyFrame(id) {
            if(!id || id === 'auto') return;
            const frame = document.getElementById('spotify-embed');
            const err = document.getElementById('music-error');
            const loader = document.getElementById('loading-music');

            loader.style.display='none';
            err.style.display='none';
            frame.style.display='block';
            frame.src = `https://open.spotify.com/embed/track/${id}?utm_source=generator&theme=0`;
        }

        window.editDailyMusic = () => {
            if(!isEditing) return;
            const userInput = prompt("Paste Link Lagu Spotify:\n(Support Link HP, Web Player, atau ID saja)");
            
            if(userInput === "") {
                setDailyMusic(globalPlaylist);
                alert("Kembali ke Mode Auto Harian.");
                return;
            }
            
            if(userInput) {
                const validId = getSpotifyId(userInput);
                if(validId) {
                    setSpotifyFrame(validId);
                    document.getElementById('spotify-embed').setAttribute('data-manual-id', validId);
                    alert("Berhasil! Lagu dipreview. Simpan (Gembok) untuk menerapkan.");
                } else {
                    alert("Format Link tidak dikenali. Coba 'Copy Song Link' lagi.");
                }
            }
        }

        /* --- STANDARD UTILS --- */
        window.addApp = () => {
            const name = prompt("Nama Project:"); if(!name) return;
            const tag = prompt("Tag (web, mobile, ui)", "web");
            
            const div = document.createElement('div');
            div.className = 'app-item editing interactive-card';
            div.setAttribute('data-tag', tag || 'web');
            div.innerHTML = `
                <div class="app-header">
                    <h4 class="app-name" contenteditable="true">${name}</h4>
                    <span class="app-tag">${tag||'WEB'}</span>
                </div>
                <p class="app-desc" contenteditable="true">Deskripsi project...</p>
                <button class="delete-btn" style="display:block" onclick="this.parentElement.remove()"><i class="fas fa-trash"></i></button>
                <a href="#" class="app-visit-btn" onclick="editLink(event,this)">Visit</a>
            `;
            document.getElementById('apps-list').prepend(div);
            init3DTilt(); 
        };

        window.addTech = () => {
            const icon = prompt("FontAwesome Class (misal: fab fa-react):", "fab fa-code");
            if(icon) {
                const div = document.createElement('div'); div.className = 'tech-item';
                div.innerHTML = `<i class="${icon}"></i><span class="tech-delete" style="display:flex" onclick="this.parentElement.remove()">x</span>`;
                document.getElementById('tech-list').appendChild(div);
            }
        };

        window.addSnippet = () => {
            const t = prompt("Judul Snippet:");
            if(!t) return;
            const d=document.createElement('div'); d.className='snippet-card';
            d.innerHTML=`<h4 contenteditable="true">${t}</h4><div class="snippet-code" contenteditable="true">// Paste code here</div><span style="position:absolute;top:10px;right:10px;color:red;cursor:pointer;font-weight:bold;" onclick="this.parentElement.remove()">x</span>`;
            document.getElementById('snippets-list').prepend(d);
        };

        // GITHUB API
        window.loadRecentRepos = async (user) => {
            const list = document.getElementById('repo-list');
            try {
                const res = await fetch(`https://api.github.com/users/${user}/repos?sort=updated&direction=desc&per_page=6`);
                if(!res.ok) throw new Error("GitHub Limit");
                const repos = await res.json();
                
                list.innerHTML = '';
                if(repos.length === 0) list.innerHTML = '<p style="color:var(--text-muted)">No repositories.</p>';
                
                repos.forEach(repo => {
                    const desc = repo.description ? (repo.description.length > 50 ? repo.description.substring(0,50)+'...' : repo.description) : 'No description';
                    const lang = repo.language || 'Code';
                    list.innerHTML += `
                        <a href="${repo.html_url}" target="_blank" style="text-decoration:none;">
                            <div class="repo-card interactive-card">
                                <div class="repo-name"><i class="fas fa-book-bookmark" style="color:var(--accent-glow)"></i> ${repo.name}</div>
                                <div class="repo-desc">${desc}</div>
                                <div class="repo-meta">
                                    <span><i class="fas fa-circle" style="font-size:8px;"></i> ${lang}</span>
                                    <span><i class="fas fa-star"></i> ${repo.stargazers_count}</span>
                                </div>
                            </div>
                        </a>
                    `;
                });
                setTimeout(()=>init3DTilt(), 500);
            } catch(e) {
                list.innerHTML = `<div style="text-align:center; padding:10px; border:1px dashed var(--glass-border); border-radius:10px; font-size:0.9rem;">Github User invalid/Limit API.<br><span onclick="configGithub()" style="color:var(--accent-glow); cursor:pointer; text-decoration:underline;">Ganti Username</span></div>`;
            }
        }
        window.configGithub=()=>{if(isEditing){const n=prompt("Masukkan Username GitHub:", localStorage.getItem('gh_user'));if(n){localStorage.setItem('gh_user',n);loadRecentRepos(n);}}};

        function renderTechStack(arr) {
            const list = document.getElementById('tech-list');
            const cleanHtml = arr.map(i => {
                const iconClass = i.replace('<span class="tech-delete" style="display:flex" onclick="this.parentElement.remove()">x</span>', '');
                return `<div class="tech-item"><i class="${iconClass}"></i><span class="tech-delete" onclick="this.parentElement.remove()">x</span></div>`;
            }).join('');
            list.innerHTML = cleanHtml;
        }

        function renderDefaultSnippets(){
            document.getElementById('snippets-list').innerHTML = `
                <div class="snippet-card"><h4>Hello World</h4><div class="snippet-code">console.log('Welcome to Lumina');</div></div>
            `;
        }

        window.splashEffect = () => { 
            const t="Lumina"; const con=document.querySelector('.splash-text'); con.innerHTML='';
            t.split('').forEach((c,i)=>{const s=document.createElement('span');s.innerText=c;s.style.animationDelay=i*0.1+'s';con.appendChild(s);});
            setTimeout(()=>{document.getElementById('splash-screen').style.opacity=0;document.getElementById('splash-screen').style.visibility='hidden';document.body.classList.remove('no-scroll');}, 2200);
        }
        window.generateQuote = () => {
            const r = quoteDB[Math.floor(Math.random() * quoteDB.length)];
            document.getElementById('splash-quote-text').innerText = `"${r.t}"`;
            document.getElementById('splash-quote-author').innerText = `- ${r.a}`;
        }
        window.init3DTilt = () => {
            if(document.body.classList.contains('perf-mode')) return;
            document.querySelectorAll('.interactive-card').forEach(card => {
                card.onmousemove = e => {
                    const r = card.getBoundingClientRect();
                    const rx = ((e.clientY - r.top - r.height/2) / r.height) * -8;
                    const ry = ((e.clientX - r.left - r.width/2) / r.width) * 8;
                    card.style.transform = `perspective(1000px) rotateX(${rx}deg) rotateY(${ry}deg) scale(1.02)`;
                    card.style.setProperty('--x', (e.clientX-r.left)+'px'); card.style.setProperty('--y',(e.clientY-r.top)+'px');
                };
                card.onmouseleave = () => card.style.transform = 'perspective(1000px) rotateX(0) rotateY(0) scale(1)';
            });
        }
        window.filterApps = (tag, btn) => {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            document.querySelectorAll('.app-item').forEach(el => {
                if(tag === 'all' || el.getAttribute('data-tag') === tag) el.classList.remove('hide'); else el.classList.add('hide');
            });
        };
        
        // Settings
        const colors = ['#38bdf8','#818cf8','#a78bfa','#f472b6','#f87171','#fb923c','#facc15','#4ade80'];
        document.getElementById('accent-grid').innerHTML = colors.map(c => `<div class="color-swatch" style="background:${c}" onclick="updateAccent('${c}')"></div>`).join('');
        
        window.updateAccent=(c)=>{ document.documentElement.style.setProperty('--accent-glow', c); localStorage.setItem('lumina_accent', c); }
        window.initTheme=()=>{
            if(localStorage.getItem('theme')=='light') document.body.classList.add('light-mode');
            const c=localStorage.getItem('lumina_accent'); if(c) updateAccent(c);
            if(localStorage.getItem('lumina_perf')=='true') togglePerf();
        }
        window.toggleTheme=()=>{document.body.classList.toggle('light-mode'); localStorage.setItem('theme', document.body.classList.contains('light-mode')?'light':'dark');}
        window.togglePerf=()=>{ const isP=document.body.classList.toggle('perf-mode'); localStorage.setItem('lumina_perf', isP); if(!isP)init3DTilt();}

        window.editLink=(e,el)=>{if(isEditing){e.preventDefault();const n=prompt("Link URL:",el.getAttribute('href'));if(n)el.setAttribute('href',n);}};
        window.openModal=id=>{document.getElementById(id).classList.add('active'); if(id=='login-modal')setTimeout(()=>document.getElementById('pin-input').focus(),100);}
        window.closeModal=id=>document.getElementById(id).classList.remove('active');
        window.handleProfileClick=()=>{if(isEditing) openModal('cropper-modal');}
        window.applyCrop=()=>{if(cropper){document.getElementById('hero-img').src=cropper.getCroppedCanvas({width:300,height:300}).toDataURL('image/jpeg', 0.6);closeModal('cropper-modal');}}
        document.getElementById('image-upload').addEventListener('change',e=>{if(e.target.files.length){const r=new FileReader();r.onload=v=>{document.getElementById('image-to-crop').src=v.target.result;if(cropper)cropper.destroy();cropper=new Cropper(document.getElementById('image-to-crop'),{aspectRatio:1,viewMode:1});};r.readAsDataURL(e.target.files[0]);}});

        // Firebase Listeners
        function setupGuestbook() {
            const q = query(collection(db, "lumina_guestbook"), orderBy("date", "desc"), limit(10));
            onSnapshot(q, (snap) => {
                const div = document.getElementById('gb-display');
                if(snap.empty){ div.innerHTML="<p style='color:grey'>Belum ada pesan.</p>"; return;}
                div.innerHTML='';
                snap.forEach(d=>{
                    const dat = d.data();
                    const del = isEditing ? `<i class="fas fa-trash gb-del" style="display:inline; margin-left:10px; color:#f87171; cursor:pointer;" onclick="delGuest('${d.id}')"></i>` : '';
                    div.innerHTML+=`<div class="gb-item"><div><span class="gb-meta">${dat.name} <small style="font-weight:400; opacity:0.7;">${new Date(dat.date.toDate()).toLocaleDateString()}</small></span><span class="gb-text">${dat.msg}</span></div>${del}</div>`;
                });
            });
        }
        window.postGuestbook=async()=>{const n=document.getElementById('gb-name').value;const m=document.getElementById('gb-msg').value;if(!m)return;await addDoc(collection(db,"lumina_guestbook"),{name:n||'Anon',msg:m,date:new Date()});document.getElementById('gb-msg').value='';};
        window.delGuest=(id)=>{if(confirm("Hapus pesan?")) deleteDoc(doc(db,"lumina_guestbook",id));};
        
        function listenToInbox(){
            const q=query(collection(db,"lumina_messages"),orderBy("date","desc"),limit(10));
            onSnapshot(q,(snap)=>{
                let h=''; let count=0;
                snap.forEach(d=>{ count++; const dat=d.data(); h+=`<div class="msg-card"><b>${dat.name}</b> (${dat.email})<br>${dat.msg}</div>`; });
                document.getElementById('inbox-list').innerHTML=h||'Kosong.';
                if(count>0) { document.getElementById('inbox-indicator').style.display='block'; }
            });
        }
        window.sendMessage=async()=>{const n=document.getElementById('c-name').value;const e=document.getElementById('c-email').value;const m=document.getElementById('c-msg').value;if(n&&e&&m){await addDoc(collection(db,"lumina_messages"),{name:n,email:e,msg:m,date:new Date()});alert("Terkirim!");}};
        window.setupObservers=()=>{const o=new IntersectionObserver(es=>es.forEach(e=>{if(e.isIntersecting){e.target.classList.add('show');o.unobserve(e.target)}}),{threshold:0.1});document.querySelectorAll('.hidden').forEach(e=>o.observe(e));}
    </script>
</body>
</html>
