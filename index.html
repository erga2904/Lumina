<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lumina | Live Portfolio</title>
    
    <!-- FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    
    <!-- ICONS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- CROPPER -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>

    <style>
        /* --- CSS VARS --- */
        :root {
            /* GLOBAL */
            --accent-glow: #38bdf8; 
            
            /* DARK MODE */
            --bg-color: #0f172a;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --glass-surface: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --input-bg: rgba(0, 0, 0, 0.3);
            
            --accent-firebase: #fbbf24; 
            --success: #34d399;
            --error: #f87171;
            --modal-bg: #1e293b; 
            
            /* GITHUB DARK */
            --graph-bg: rgba(0,0,0,0.2);
            --graph-l0: #161b22; --graph-l1: #0e4429; --graph-l2: #006d32; --graph-l3: #26a641; --graph-l4: #39d353;
            --track-color: rgba(255,255,255,0.15);
        }

        body.light-mode {
            --bg-color: #f1f5f9;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --glass-surface: rgba(255, 255, 255, 0.6);
            --glass-border: rgba(255, 255, 255, 0.8);
            --input-bg: rgba(255, 255, 255, 0.8);
            --modal-bg: rgba(255, 255, 255, 0.95);
            
            --graph-bg: rgba(255,255,255,0.5);
            --graph-l0: #ebedf0; --graph-l1: #9be9a8; --graph-l2: #40c463; --graph-l3: #30a14e; --graph-l4: #216e39;
            --track-color: rgba(0,0,0,0.1);
        }

        /* PERF MODE */
        body.perf-mode {
            --glass-surface: #1e293b; --modal-bg: #1e293b; --glass-border: #334155;
        }
        body.light-mode.perf-mode {
            --glass-surface: #ffffff; --modal-bg: #ffffff; --glass-border: #cbd5e1;
        }
        body.perf-mode .ambient-light, body.perf-mode .interactive-card::before { display: none; }
        body.perf-mode .acrylic-panel, body.perf-mode .modal-content, body.perf-mode .category-badge {
            backdrop-filter: none !important; box-shadow: none !important;
        }

        html { scroll-behavior: smooth; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; outline: none; }
        body { background-color: var(--bg-color); color: var(--text-main); overflow-x: hidden; min-height: 100vh; transition: background-color 0.4s; }
        body.no-scroll { overflow: hidden; height: 100vh; }

        /* 3D & GLOW */
        .interactive-card { position: relative; transition: transform 0.1s ease; transform-style: preserve-3d; overflow: hidden; }
        .interactive-card::before { content:''; position: absolute; top: var(--y, 50%); left: var(--x, 50%); width: 350px; height: 350px; background: radial-gradient(circle, var(--accent-glow) 0%, transparent 60%); opacity: 0; transform: translate(-50%, -50%); transition: opacity 0.3s; pointer-events: none; mix-blend-mode: overlay; z-index: 0; }
        .interactive-card:hover::before { opacity: 0.15; }
        .interactive-card > * { position: relative; z-index: 2; }

        /* SPLASH */
        #splash-screen { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background-color: var(--bg-color); z-index: 99999; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: opacity 0.8s ease-out, visibility 0.8s; padding: 20px; }
        .splash-text { font-size: 4rem; font-weight: 800; color: var(--text-main); margin-bottom: 30px; letter-spacing: -2px;}
        .splash-text span { display: inline-block; opacity: 0; filter: blur(10px); transform: scale(1.1); animation: blurIn 0.8s forwards ease-in-out; }
        .quote-container { margin-top: 20px; max-width: 600px; text-align: center; opacity: 0; transform: translateY(20px); animation: floatUp 1s ease-out forwards; animation-delay: 0.8s; background: rgba(255, 255, 255, 0.03); border: 1px solid var(--glass-border); padding: 25px; border-radius: 15px; backdrop-filter: blur(10px); }
        .quote-en { font-family: 'Playfair Display', serif; font-style: italic; font-size: 1.1rem; color: var(--text-main); margin-bottom: 8px; }
        .quote-id { font-size: 0.9rem; color: var(--text-muted); margin-bottom: 15px; }
        .quote-author { font-size: 0.85rem; font-weight: 700; color: var(--accent-glow); text-transform: uppercase; }
        .quote-author::before { content: 'â€” '; }
        @keyframes blurIn { to { opacity: 1; filter: blur(0); transform: scale(1); } }
        @keyframes floatUp { to { opacity: 1; transform: translateY(0); } }

        .acrylic-panel { background: var(--glass-surface); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid var(--glass-border); border-top: 1px solid rgba(255,255,255,0.2); box-shadow: 0 4px 30px rgba(0,0,0,0.1); border-radius: 20px; }
        .ambient-light { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }
        .orb { position: absolute; border-radius: 50%; filter: blur(80px); opacity: 0.5; animation: float 15s infinite; transition: background 0.5s; }
        .orb-1 { width: 60vw; height: 60vw; top: -10%; left: -10%; background: var(--accent-glow); }
        .orb-2 { width: 50vw; height: 50vw; bottom: 0; right: 0; background: var(--accent-glow); filter: hue-rotate(45deg) blur(80px); animation-delay: -5s; }
        @keyframes float { 0%,100%{transform:translate(0,0)} 50%{transform:translate(20px,40px)} }

        nav { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 600px; padding: 12px 30px; z-index: 5000; display: flex; justify-content: space-between; align-items: center; border-radius: 50px; background: rgba(255,255,255,0.01); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border: 1px solid var(--glass-border); }
        nav h3 { font-weight: 800; font-size: 1.2rem; color: var(--text-main); margin: 0; }
        nav ul { display: flex; gap: 20px; list-style: none; align-items: center; margin: 0; }
        nav a { text-decoration: none; color: var(--text-main); font-size: 0.9rem; font-weight: 600; opacity: 0.7; transition: 0.3s; cursor: pointer; }
        nav a:hover { opacity: 1; color: var(--accent-glow); }

        .hero { min-height: 100vh; display: flex; flex-direction: column; justify-content: flex-start; align-items: center; padding-top: 150px; padding-bottom: 50px; gap: 20px;}
        .hero-card { padding: 40px; width: 90%; max-width: 600px; text-align: center; }
        .profile-container { width: 140px; height: 140px; margin: 0 auto 20px; position: relative; }
        .profile-pic { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 4px solid var(--glass-border); box-shadow: 0 10px 40px rgba(0,0,0,0.2); background: #333; }
        .profile-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); border-radius: 50%; display: none; align-items: center; justify-content: center; cursor: pointer; color: #fff; font-size: 1.5rem; transition: 0.3s; }
        .profile-container:hover .profile-overlay { opacity: 1; display: flex;}

        .social-links { display: flex; gap: 15px; justify-content: center; margin-top: 25px; }
        .social-icon { color: var(--text-muted); font-size: 1.4rem; padding: 12px; background: rgba(255,255,255,0.03); border-radius: 50%; transition: 0.3s; text-decoration: none; border: 1px solid transparent; }
        .social-icon:hover { color: var(--accent-glow); background: rgba(255,255,255,0.1); transform: translateY(-3px); }
        .social-icon.editing { border-color: var(--accent-glow); border-style: dashed; cursor: text; }

        section { max-width: 900px; margin: 0 auto 60px; width: 90%; scroll-margin-top: 100px; }
        .section-header { font-size: 1.5rem; font-weight: 700; margin-bottom: 30px; border-bottom: 2px solid var(--accent-glow); padding-bottom: 5px; display: inline-block; color: var(--text-main); position: relative; padding-right: 120px;}

        /* API STATUS BADGE (Fixed Cursor) */
        .api-status { position: absolute; right: 0; top: 5px; font-size: 0.75rem; padding: 4px 10px; border-radius: 20px; font-weight: 600; display: inline-flex; align-items: center; gap: 6px; letter-spacing: 0.5px; opacity: 0; transition: 0.3s; transform: translateX(10px); cursor: pointer; z-index: 10;}
        .api-status.show { opacity: 1; transform: translateX(0); }
        .api-status.online { background: rgba(52, 211, 153, 0.15); color: var(--success); border: 1px solid var(--success); cursor: default; }
        .api-status.offline { background: rgba(248, 113, 113, 0.15); color: var(--error); border: 1px solid var(--error); }
        .api-status.offline:hover { background: rgba(248, 113, 113, 0.3); } /* Hover effect */
        .dot-status { width: 6px; height: 6px; border-radius: 50%; background: currentColor; }

        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-top: 20px; }
        .option-card { padding: 30px; text-align: center; cursor: pointer; transition: 0.3s; min-height: 180px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .card-icon { font-size: 2.5rem; margin-bottom: 15px; transition: 0.3s; color: var(--text-muted); }
        .option-card:hover .card-icon { transform: scale(1.1) rotate(5deg); color: var(--accent-glow); }
        .status-badge { position: absolute; top: 15px; right: 15px; font-size: 0.7rem; background: rgba(0,0,0,0.4); padding: 4px 10px; border-radius: 20px; color: #fff; }

        .apps-grid { display: grid; grid-template-columns: 1fr; gap: 20px; }
        .app-item { background: rgba(255,255,255,0.03); border: 1px solid var(--glass-border); border-left: 4px solid var(--accent-glow); padding: 25px; border-radius: 15px; display: flex; flex-direction: column; position: relative; }
        .app-name { font-size: 1.2rem; font-weight: 700; color: var(--text-main); margin-bottom: 8px; }
        .app-desc { font-size: 0.95rem; color: var(--text-muted); margin-bottom: 15px; line-height: 1.6; }
        .app-visit-btn { display: inline-block; padding: 8px 20px; border-radius: 50px; border: 1px solid var(--glass-border); color: var(--text-main); text-decoration: none; font-size: 0.9rem; align-self: flex-start; transition: 0.3s; background: rgba(255,255,255,0.05); }
        .app-visit-btn:hover { background: var(--accent-glow); border-color: var(--accent-glow); color: #fff; }
        .delete-btn { position: absolute; top: 20px; right: 20px; background: none; border: none; color: #ff4757; font-size: 1.2rem; cursor: pointer; display: none; }
        .app-item.editing .delete-btn { display: block; }

        .activity-wrapper { background: var(--graph-bg); padding: 20px; border-radius: 15px; border: 1px solid var(--glass-border); display: flex; justify-content: center; width: 100%; overflow: hidden; min-height: 100px; position: relative; }
        
        .contribution-graph { display: grid; grid-template-rows: repeat(7, 10px); grid-auto-flow: column; gap: 3px; }
        .day-box { width: 10px; height: 10px; border-radius: 2px; background-color: var(--graph-l0); transition: 0.2s; }
        .day-box:hover { transform: scale(1.5); z-index: 5; border: 1px solid #fff; }
        [data-level="0"]{background:var(--graph-l0)} [data-level="1"]{background:var(--graph-l1)} [data-level="2"]{background:var(--graph-l2)} [data-level="3"]{background:var(--graph-l3)} [data-level="4"]{background:var(--graph-l4)}
        
        /* Empty Graph State */
        .empty-state-graph { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: var(--text-muted); font-size: 0.9rem; text-align: center; }

        .legend-details { display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap; font-size: 0.8rem; color: var(--text-muted); }
        .legend-item { display: flex; align-items: center; gap: 8px; background: rgba(255,255,255,0.03); padding: 5px 10px; border-radius: 5px; }
        .legend-color { width: 12px; height: 12px; border-radius: 2px; }

        .activity-section-split { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 30px; border-top: 1px solid var(--glass-border); padding-top: 25px; }
        .activity-column h3 { font-size: 1rem; color: var(--text-main); margin-bottom: 15px; font-weight: 700; opacity: 0.9; }
        .recent-item { padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.05); display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem;}
        
        .repo-link { color: var(--accent-glow); font-weight: 700; text-decoration: none; margin-right: 10px; max-width: 60%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .log-action { color: var(--accent-firebase); font-weight: 700; margin-right: 10px; }
        .log-date { font-size: 0.75rem; color: var(--text-muted); opacity: 0.7; white-space: nowrap; }

        @media (max-width: 768px) { .activity-section-split { grid-template-columns: 1fr; gap: 20px; } }

        /* CHANGELOG - VERSIONLESS LAYOUT FIXED */
        #changelog-section { font-size: 0.9rem; }
        .timeline { position: relative; margin-left: 10px; padding-left: 20px; }
        .timeline::before { content:''; position: absolute; top: 0; bottom: 0; left: 6px; width: 4px; background: var(--track-color); border-radius: 10px; }
        .timeline-item { position: relative; margin-bottom: 30px; }
        .timeline-item:last-child { margin-bottom: 0; }
        
        .timeline-item::after { content: ''; position: absolute; left: -29px; top: 5px; width: 10px; height: 10px; background: var(--text-muted); border-radius: 50%; z-index: 2; box-shadow: 0 0 0 4px var(--bg-color); transition: 0.3s; }
        .timeline-item:first-child::after { background: var(--accent-glow); height: 25px; border-radius: 10px; top: 0px; box-shadow: 0 0 15px var(--accent-glow); }

        .timeline-item > div { display: flex; align-items: center; gap: 15px; margin-bottom: 6px; }
        .version-badge { display: none !important; } /* Force Hide old data */

        .category-badge { display: inline-block; font-size: 0.65rem; padding: 2px 8px; border-radius: 4px; text-transform: uppercase; font-weight: 800; letter-spacing: 0.5px; border: 1px solid transparent; background: rgba(255,255,255,0.05); color: var(--text-muted); }
        .cat-feature { background: rgba(52, 211, 153, 0.15); color: #34d399; border-color: #34d399; }
        .cat-fix { background: rgba(248, 113, 113, 0.15); color: #f87171; border-color: #f87171; }
        .cat-style { background: rgba(167, 139, 250, 0.15); color: #a78bfa; border-color: #a78bfa; }
        .cat-core { background: rgba(56, 189, 248, 0.15); color: #38bdf8; border-color: #38bdf8; }

        .version-date { font-size: 0.75rem; color: var(--text-muted); font-weight: 600; opacity: 0.8; }
        .version-desc { margin-top: 0px; color: var(--text-main); line-height: 1.5; font-size: 0.9rem; }

        /* SETTINGS & MODALS */
        .color-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; margin-bottom: 20px; margin-top: 15px;}
        .color-swatch { width: 45px; height: 45px; border-radius: 10px; cursor: pointer; transition: 0.2s; border: 2px solid transparent; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .color-swatch:hover { transform: scale(1.1); border-color: #fff; }
        .color-label { display: block; text-align: left; font-size: 0.85rem; color: var(--text-muted); margin-bottom: 5px; margin-top: 15px;}

        .perf-switch-container { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; }
        .perf-btn { flex: 1; padding: 12px; border-radius: 10px; border: 1px solid var(--glass-border); background: var(--input-bg); color: var(--text-muted); cursor: pointer; transition: 0.3s; font-size: 0.85rem; }
        .perf-btn.active { background: var(--accent-glow); color: #fff; border-color: var(--accent-glow); font-weight: 700; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.8); backdrop-filter: blur(8px); z-index: 9999; display: flex; justify-content: center; align-items: center; opacity: 0; visibility: hidden; transition: 0.3s; }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-content { background: var(--modal-bg); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px); width: 90%; max-width: 400px; padding: 30px; border-radius: 20px; text-align: center; border: 1px solid var(--glass-border); box-shadow: 0 25px 50px rgba(0,0,0,0.5); color: var(--text-main); transform: scale(0.9); transition: transform 0.3s; }
        .modal-overlay.active .modal-content { transform: scale(1); }
        
        input.pin-field { width: 100%; padding: 15px; font-size: 2rem; text-align: center; margin: 20px 0; background: var(--input-bg); border: 1px solid var(--glass-border); color: var(--text-main); border-radius: 12px; letter-spacing: 8px; }
        input.pin-field:focus { border-color: var(--accent-glow); }
        
        [contenteditable="true"] { border: 1px dashed var(--accent-glow); background: rgba(56, 189, 248, 0.1); padding: 0 5px; border-radius: 4px; display: inline-block; cursor: text; min-width: 10px;}
        .close-modal { position: absolute; top: 20px; right: 20px; cursor: pointer; font-size: 1.5rem; color: var(--text-muted); transition:0.2s }
        .close-modal:hover { color: var(--text-main); }
        #add-app-btn { position: absolute; top: 30px; right: 30px; font-size: 2rem; color: var(--success); cursor: pointer; display: none; }
        .crop-container { height: 350px; background: #000; margin: 15px 0; border-radius: 10px; overflow: hidden; }
        #image-to-crop { display: block; max-width: 100%; }
        footer { width: 100%; padding: 30px 0; text-align: center; color: var(--text-muted); font-size: 0.9rem; margin-top: 50px; border-top: 1px solid var(--glass-border); position: relative; background: var(--bg-color); z-index: 5; }
    </style>
</head>
<body class="no-scroll">

    <div id="splash-screen">
        <h1 class="splash-text"></h1>
        <div class="quote-container">
            <p id="quote-en" class="quote-en"></p>
            <p id="quote-id" class="quote-id"></p>
            <p id="quote-author" class="quote-author"></p>
        </div>
    </div>

    <div class="ambient-light"><div class="orb orb-1"></div><div class="orb orb-2"></div></div>

    <nav class="acrylic-panel">
        <h3>Lumina</h3>
        <ul>
            <li><a href="#menu-utama">Home</a></li>
            <li><a href="#apps-section">Apps</a></li>
            <li><a onclick="openModal('settings-modal')" style="cursor: pointer;"><i class="fas fa-cog"></i></a></li>
            <li><a href="#" onclick="openModal('login-modal')"><i class="fas fa-user"></i></a></li>
            <li><a onclick="toggleTheme()" style="cursor: pointer;"><i class="fas fa-sun" id="theme-icon"></i></a></li>
        </ul>
    </nav>

    <div class="hero">
        <div class="hero-card acrylic-panel interactive-card hidden">
            <div class="profile-container" id="profile-trigger" onclick="handleProfileClick()">
                <img src="https://ui-avatars.com/api/?name=User&background=38bdf8&color=fff" 
                     onerror="this.src='https://ui-avatars.com/api/?name=U&background=random'" 
                     alt="Profile" class="profile-pic" id="hero-img">
                <div class="profile-overlay"><i class="fas fa-camera"></i></div>
            </div>
            <h1 id="user-name">Your Name</h1>
            <p id="user-bio" style="font-size: 1.1rem; color: var(--text-muted); margin-top: 10px;">Web Developer</p>
            
            <div class="social-links">
                <a href="#" class="social-icon" id="link-github" onclick="editLink(event, this)"><i class="fab fa-github"></i></a>
                <a href="#" class="social-icon" id="link-twitter" onclick="editLink(event, this)"><i class="fa-brands fa-x-twitter"></i></a>
                <a href="#" class="social-icon" id="link-email" onclick="editLink(event, this)"><i class="fas fa-envelope"></i></a>
            </div>
        </div>
    </div>

    <!-- DASHBOARD -->
    <section id="menu-utama">
        <h2 class="section-header hidden">Dashboard</h2>
        <div class="grid">
            <div class="option-card acrylic-panel interactive-card hidden" onclick="handleEditAuth()" id="card-edit">
                <div class="status-badge" id="lock-badge"><i class="fas fa-lock"></i> Locked</div>
                <div class="card-icon"><i class="fas fa-user-cog"></i></div>
                <div class="card-title" id="dash-title-1">Edit Profile</div>
                <div class="card-desc" id="dash-desc-1">Tap to login/save</div>
            </div>
            <div class="option-card acrylic-panel interactive-card hidden" onclick="document.getElementById('apps-section').scrollIntoView({behavior:'smooth'})">
                <div class="card-icon"><i class="fas fa-cubes"></i></div>
                <div class="card-title" id="dash-title-2">My Apps</div>
                <div class="card-desc" id="dash-desc-2">Jump to Projects</div>
            </div>
        </div>
    </section>

    <!-- APPS -->
    <section id="apps-section">
        <div class="acrylic-panel hidden" style="padding: 30px; position: relative;">
            <h2 class="section-header">Applications</h2>
            <i id="add-app-btn" class="fas fa-plus-circle" onclick="addApp()"></i>
            <div class="apps-grid" id="apps-list"></div>
        </div>
    </section>

    <!-- ACTIVITY -->
    <section id="activity-section">
        <div class="acrylic-panel hidden" style="padding: 30px;">
            <div style="display:flex; justify-content: space-between; align-items:center;">
                <h2 class="section-header" style="margin-bottom:0; border-bottom:0;">
                    Activity Hub 
                    <!-- API STATUS FIXER -->
                    <span id="api-status-badge" class="api-status" onclick="fixGithubUser()" title="Click to fix username"></span>
                </h2>
                <i class="fas fa-cog" id="gh-config-btn" onclick="configureGithub()" style="display:none; color:var(--text-muted); cursor:pointer;"></i>
            </div>
            <p id="total-contributions" style="font-size:0.9rem; color:var(--text-muted); margin-bottom:20px;">Connecting GitHub...</p>
            <div class="activity-wrapper">
                <div class="contribution-graph" id="contribution-grid"></div>
            </div>
            <div class="legend-details">
                <div class="legend-item"><div class="legend-color" style="background:var(--graph-l0)"></div> <span class="legend-label" id="legend-1">0 - lagi mager -_-</span></div>
                <div class="legend-item"><div class="legend-color" style="background:var(--graph-l2)"></div> <span class="legend-label" id="legend-2">Med</span></div>
                <div class="legend-item"><div class="legend-color" style="background:var(--graph-l4)"></div> <span class="legend-label" id="legend-3">On Fire!</span></div>
            </div>
            <div class="activity-section-split">
                <div class="activity-column">
                    <h3><i class="fab fa-github"></i> GitHub Events</h3>
                    <div id="github-feed" style="font-size:0.9rem; color:var(--text-muted);">Loading...</div>
                </div>
                <div class="activity-column">
                    <h3><i class="fas fa-bolt" style="color: var(--accent-firebase)"></i> Portfolio Updates</h3>
                    <div id="firebase-feed" style="font-size:0.9rem; color:var(--text-muted);">Syncing live...</div>
                </div>
            </div>
        </div>
    </section>

    <!-- CHANGELOG -->
    <section id="changelog-section">
        <div class="acrylic-panel hidden" style="padding: 30px;">
            <h2 class="section-header">System Changelog</h2>
            <div class="timeline" id="changelog-list">
                <!-- Backup History if needed -->
                <div class="timeline-item">
                    <div>
                        <span class="category-badge cat-feature">FEATURE</span>
                        <span class="version-date">Today</span>
                    </div>
                    <p class="version-desc">Robust API Logic V2.5.1: Added auto-trim username, click-to-fix bad api state, and safer fallbacks.</p>
                </div>
            </div>
        </div>
    </section>

    <footer><p>&copy; 2025 Lumina. Built with code & passion.</p></footer>

    <!-- SETTINGS MODAL -->
    <div class="modal-overlay" id="settings-modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('settings-modal')">&times;</span>
            <h3 style="margin-bottom:20px;">Settings</h3>
            <span class="color-label">Graphics Quality</span>
            <div class="perf-switch-container">
                <div class="perf-btn active" id="btn-qual" onclick="setPerformanceMode(false)">Quality</div>
                <div class="perf-btn" id="btn-perf" onclick="setPerformanceMode(true)">Performance</div>
            </div>
            <span class="color-label">Theme Accent</span>
            <div style="display:flex; gap:10px; align-items:center; margin-bottom:10px;">
                <input type="color" id="accent-picker" style="width:100%; height:40px; border:none; cursor:pointer; background:none;" oninput="updateAccent(this.value)">
            </div>
            <div class="color-grid">
                <div class="color-swatch" style="background:#38bdf8;" onclick="updateAccent('#38bdf8')"></div>
                <div class="color-swatch" style="background:#818cf8;" onclick="updateAccent('#818cf8')"></div>
                <div class="color-swatch" style="background:#a78bfa;" onclick="updateAccent('#a78bfa')"></div>
                <div class="color-swatch" style="background:#f472b6;" onclick="updateAccent('#f472b6')"></div>
                <div class="color-swatch" style="background:#fb7185;" onclick="updateAccent('#fb7185')"></div>
                <div class="color-swatch" style="background:#f87171;" onclick="updateAccent('#f87171')"></div>
                <div class="color-swatch" style="background:#fb923c;" onclick="updateAccent('#fb923c')"></div>
                <div class="color-swatch" style="background:#facc15;" onclick="updateAccent('#facc15')"></div>
                <div class="color-swatch" style="background:#4ade80;" onclick="updateAccent('#4ade80')"></div>
                <div class="color-swatch" style="background:#2dd4bf;" onclick="updateAccent('#2dd4bf')"></div>
            </div>
            <p style="font-size:0.7rem; color:var(--text-muted); margin-top:10px;">Preference saved locally.</p>
        </div>
    </div>

    <div class="modal-overlay" id="login-modal"><div class="modal-content"><span class="close-modal" onclick="closeModal('login-modal')">&times;</span><h3>Admin Access</h3><input type="password" id="pin-input" class="pin-field" placeholder="â€¢â€¢â€¢â€¢" maxlength="4" inputmode="numeric"><button onclick="checkPin()" class="app-visit-btn" style="width:100%; background:var(--accent-glow); border:none; color:#fff; cursor:pointer;">UNLOCK</button></div></div>
    <div class="modal-overlay" id="cropper-modal"><div class="modal-content" style="max-width:500px;"><span class="close-modal" onclick="closeModal('cropper-modal')">&times;</span><h3>Update Profile</h3><input type="file" id="image-upload" accept="image/*" style="margin:20px 0;"><div style="height:350px; background:#000; border-radius:10px; overflow:hidden; margin-bottom:15px;"><img id="image-to-crop" style="display:block; max-width:100%;" src=""></div><div style="display:flex; gap:10px; justify-content:center;"><button onclick="applyCrop()" class="app-visit-btn" style="background:var(--success); border:none; color:#fff; cursor:pointer;">Save</button></div></div></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, collection, addDoc, query, orderBy, limit, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // === CONFIG ===
        const UPDATE_MSG = 'Stability Update v2.5.1: "Click-to-Fix" API status added. Auto-trimmed username input to prevent API errors. Improved Fallbacks.';

        const firebaseConfig = {
        const firebaseConfig = {
  apiKey: "AIzaSyDfpLYr8g8ltUpdV_1HuN-S_m8vnMqqtYI",
  authDomain: "lumina-portofolio.firebaseapp.com",
  projectId: "lumina-portofolio",
  storageBucket: "lumina-portofolio.firebasestorage.app",
  messagingSenderId: "797132104566",
  appId: "1:797132104566:web:a62ecbb9827dc5b0209057"
};

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const ADMIN_PIN = '2908';
        const docRef = doc(db, "users", "my-portfolio");
        let isEditing = false;
        let cropper = null;

        const quoteDB = [
            { en: "Stay hungry, stay foolish.", id: "Tetaplah lapar, tetaplah bodoh.", author: "Steve Jobs" },
            { en: "Code is like humor. When you have to explain it, itâ€™s bad.", id: "Kode itu seperti lelucon. Jika harus dijelaskan, berarti buruk.", author: "Cory House" }
        ];

        const themeQuery = window.matchMedia('(prefers-color-scheme: light)');

        if (history.scrollRestoration) history.scrollRestoration = 'manual';
        window.scrollTo(0,0);

        window.addEventListener('DOMContentLoaded', () => {
            splashEffect();
            generateQuote(); 
            loadFromDB(); 
            initTheme(); 
            initAccentColor();
            initPerformanceMode();
            setupObservers();
            setupActivityListener();
            window.addEventListener('resize', () => { 
                const u = localStorage.getItem('gh_user'); 
                if(u) loadGithubData(u.trim()); 
            });
        });

        // --- NEW: USER CLICK TO FIX ---
        window.fixGithubUser = async () => {
            const newUser = prompt("Fix GitHub Username:", localStorage.getItem('gh_user') || "");
            if(newUser) {
                const cleanedUser = newUser.trim(); // FORCE TRIM
                localStorage.setItem('gh_user', cleanedUser);
                loadGithubData(cleanedUser);
            }
        };

        // --- API LOAD (Improved) ---
        window.loadGithubData = async (user) => {
            user = user ? user.trim() : 'erga2904'; // Safer default
            
            const grid = document.getElementById('contribution-grid');
            const feed = document.getElementById('github-feed');
            const statusBadge = document.getElementById('api-status-badge');
            
            grid.innerHTML = '';
            document.getElementById('total-contributions').innerText = "Connecting to GitHub...";
            statusBadge.className = 'api-status'; statusBadge.innerHTML = '';

            try {
                const res = await fetch(`https://github-contributions-api.jogruber.de/v4/${user}?y=last`);
                if (res.ok) {
                    statusBadge.innerHTML = '<div class="dot-status"></div> API Online';
                    statusBadge.classList.add('show', 'online');
                    statusBadge.onclick = null; // Remove fix handler if online
                    
                    const d = await res.json();
                    const w = window.innerWidth;
                    let daysCount = 364; if(w<600)daysCount=120; else if(w<900)daysCount=200;
                    const days = (d.contributions||[]).slice(-daysCount);
                    document.getElementById('total-contributions').innerText = `${d.total?.lastYear || '?'} contributions (${user})`;
                    days.forEach(day => {
                        const dDiv = document.createElement('div'); dDiv.className = 'day-box'; dDiv.setAttribute('data-level', day.level); dDiv.title = `${day.date}: ${day.count}`; grid.appendChild(dDiv);
                    });
                } else if (res.status === 404) {
                    throw new Error("User Not Found");
                } else {
                    throw new Error("Limit");
                }
            } catch(e) {
                // If 404, User clickable "Fix"
                if (e.message === "User Not Found") {
                    statusBadge.innerHTML = '<div class="dot-status"></div> User Not Found (Click to Fix)';
                    statusBadge.classList.add('show', 'offline');
                    statusBadge.setAttribute('onclick', 'fixGithubUser()');
                    statusBadge.style.cursor = 'pointer';
                    document.getElementById('total-contributions').innerText = `Username '${user}' unknown`;
                } else {
                    statusBadge.innerHTML = '<div class="dot-status"></div> API Rate Limit';
                    statusBadge.classList.add('show', 'offline');
                    document.getElementById('total-contributions').innerText = `Data Unavailable`;
                }
                grid.innerHTML = '<div class="empty-state-graph">Chart Offline</div>';
            }

            try {
                const evt = await fetch(`https://api.github.com/users/${user}/events/public?per_page=100`);
                if(evt.ok) {
                    const evData = await evt.json();
                    const filter = evData.filter(e => ['PushEvent','CreateEvent'].includes(e.type)).slice(0,5);
                    feed.innerHTML='';
                    if(filter.length===0) feed.innerText="No recent events.";
                    filter.forEach(e => {
                        let icon='ðŸ“Œ', msg='Updated';
                        if(e.type=='PushEvent') { icon='âš¡'; msg=e.payload.commits?.[0]?.message||'Push'; }
                        if(e.type=='CreateEvent') { icon='âœ¨'; msg='New Repo'; }
                        feed.innerHTML += `<div class="recent-item"><a href="https://github.com/${e.repo.name}" target="_blank" class="repo-link">${icon} ${e.repo.name}</a><span class="log-date" style="font-size:0.75rem">${msg}</span></div>`;
                    });
                }
            } catch(e){ console.log("Event Err"); }
        }

        async function loadFromDB() {
            try {
                const snap = await getDoc(docRef);
                const data = snap.exists() ? snap.data() : {};
                
                // Logic changelog 
                let currentHtml = data.changelogHtml;
                if (currentHtml && currentHtml.length > 50) { 
                    if (!currentHtml.includes(UPDATE_MSG)) { 
                        const d = new Date().toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' });
                        const newLog = `<div class="timeline-item"><div><span class="category-badge cat-feature">FEATURE</span><span class="version-date">${d}</span></div><p class="version-desc">${UPDATE_MSG}</p></div>`;
                        document.getElementById('changelog-list').innerHTML = newLog + currentHtml;
                    } else { document.getElementById('changelog-list').innerHTML = currentHtml; }
                } 
                document.getElementById('changelog-list').querySelectorAll('[contenteditable]').forEach(e=>e.removeAttribute('contenteditable'));

                if(data.legendTexts) {
                    document.getElementById('legend-1').innerText = data.legendTexts.l1 || "0 - lagi mager -_-";
                    document.getElementById('legend-2').innerText = data.legendTexts.l2 || "Med";
                    document.getElementById('legend-3').innerText = data.legendTexts.l3 || "On Fire!";
                }
                if(data.name) document.getElementById('user-name').innerText = data.name;
                if(data.bio) document.getElementById('user-bio').innerText = data.bio;
                if(data.links) {
                    document.getElementById('link-github').setAttribute('href', data.links.git);
                    if(data.links.tw) document.getElementById('link-twitter').setAttribute('href', data.links.tw); 
                    document.getElementById('link-email').setAttribute('href', data.links.mail);
                }
                if(data.photoBase64) document.getElementById('hero-img').src = data.photoBase64;
                if(data.dashboardTexts) {
                    document.getElementById('dash-title-1').innerText = data.dashboardTexts.t1 || "Edit Profile";
                    document.getElementById('dash-desc-1').innerText = data.dashboardTexts.d1 || "Tap to login/save";
                    document.getElementById('dash-title-2').innerText = data.dashboardTexts.t2 || "My Apps";
                    document.getElementById('dash-desc-2').innerText = data.dashboardTexts.d2 || "Jump to Projects";
                }
                if(data.appsHtml) {
                    const t = document.createElement('div'); t.innerHTML = data.appsHtml;
                    t.querySelectorAll('[contenteditable]').forEach(e=>e.removeAttribute('contenteditable'));
                    t.querySelectorAll('.app-item').forEach(e=>e.classList.remove('editing','interactive-card'));
                    document.getElementById('apps-list').innerHTML = t.innerHTML;
                }

                // FORCE TRIM HERE TOO
                let user = (data.ghUsername || 'erga2904').trim();
                localStorage.setItem('gh_user', user);
                loadGithubData(user);
            } catch(e) { console.error(e); }
            if(localStorage.getItem('lumina_perf') !== 'true') setup3DInteractions();
        }

        async function logToFirebase(action) { try { await addDoc(collection(db, "lumina_logs"), { action: action, timestamp: new Date() }); } catch(e){} }
        
        function setupActivityListener() {
            const q = query(collection(db, "lumina_logs"), orderBy("timestamp", "desc"), limit(5));
            onSnapshot(q, (snapshot) => {
                const feed = document.getElementById("firebase-feed");
                if(snapshot.empty) { feed.innerHTML = "No logs yet."; return; }
                let html = '';
                snapshot.forEach(doc => {
                    const data = doc.data();
                    let date = data.timestamp ? data.timestamp.toDate().toLocaleDateString() : 'N/A';
                    html += `<div class="recent-item"><span class="log-action"><i class="fas fa-check-circle"></i> ${data.action}</span><span class="log-date">${date}</span></div>`;
                });
                feed.innerHTML = html;
            });
        }

        // SAVE LOCK
        window.saveAndLock = async function() {
            if(!confirm("Simpan & Kunci?")) return;
            document.body.style.cursor = 'wait';
            
            if(confirm("Tambah Log Manual?")) {
                const catInput = prompt("Kategori? (feature/fix/style/core)").toLowerCase();
                const desc = prompt("Keterangan:");
                if(desc) {
                    const d = new Date().toLocaleDateString('id-ID',{day:'numeric',month:'short',year:'numeric'});
                    let catClass='cat-core', catLabel='CORE';
                    if(catInput.includes('fix')) {catClass='cat-fix'; catLabel='FIX';}
                    else if(catInput.includes('feat')) {catClass='cat-feature'; catLabel='FEATURE';}
                    else if(catInput.includes('style')) {catClass='cat-style'; catLabel='STYLE';}
                    
                    const newItem = `<div class="timeline-item"><div><span class="category-badge ${catClass}">${catLabel}</span><span class="version-date">${d}</span></div><p class="version-desc">${desc}</p></div>`;
                    document.getElementById('changelog-list').insertAdjacentHTML('afterbegin', newItem);
                }
            }

            try {
                const list = document.getElementById('apps-list').cloneNode(true);
                list.querySelectorAll('.delete-btn').forEach(b => b.style.display='none');
                list.querySelectorAll('[contenteditable]').forEach(e => e.removeAttribute('contenteditable'));
                list.querySelectorAll('.app-item').forEach(e => e.classList.remove('editing'));

                const logs = document.getElementById('changelog-list').cloneNode(true);
                logs.querySelectorAll('[contenteditable]').forEach(e => e.removeAttribute('contenteditable'));

                const payload = {
                    name: document.getElementById('user-name').innerText,
                    bio: document.getElementById('user-bio').innerText,
                    photoBase64: document.getElementById('hero-img').src,
                    dashboardTexts: {
                        t1: document.getElementById('dash-title-1').innerText, d1: document.getElementById('dash-desc-1').innerText,
                        t2: document.getElementById('dash-title-2').innerText, d2: document.getElementById('dash-desc-2').innerText,
                    },
                    legendTexts: {
                        l1: document.getElementById('legend-1').innerText,
                        l2: document.getElementById('legend-2').innerText,
                        l3: document.getElementById('legend-3').innerText,
                    },
                    appsHtml: list.innerHTML,
                    changelogHtml: logs.innerHTML, 
                    
                    // SAVE USERNAME SAFER
                    ghUsername: (localStorage.getItem('gh_user') || 'erga2904').trim(),
                    
                    links: {
                        git: document.getElementById('link-github').getAttribute('href'),
                        tw: document.getElementById('link-twitter').getAttribute('href'),
                        mail: document.getElementById('link-email').getAttribute('href'),
                    }
                };
                await setDoc(docRef, payload, { merge: true });
                await logToFirebase("Update Profile");
                window.location.reload(); 
            } catch(e) { alert(e.message); document.body.style.cursor='default'; }
        };

        window.handleEditAuth = function() { if(isEditing) window.saveAndLock(); else openModal('login-modal'); };
        window.checkPin = () => { if(document.getElementById('pin-input').value === ADMIN_PIN) { closeModal('login-modal'); enableEditing(); } else alert("PIN Salah"); };

        function enableEditing() {
            isEditing=true;
            document.getElementById('lock-badge').innerText = 'Unlock';
            document.getElementById('lock-badge').style.background = '#34d399';
            const ids = ['user-name','user-bio','dash-title-1','dash-desc-1','dash-title-2','dash-desc-2'];
            ids.forEach(id => document.getElementById(id).contentEditable="true");
            document.querySelectorAll('.legend-label').forEach(e => e.contentEditable="true");
            document.querySelectorAll('.category-badge').forEach(e => e.contentEditable="true");
            document.querySelectorAll('.version-date').forEach(e => e.contentEditable="true");
            document.querySelectorAll('.version-desc').forEach(e => e.contentEditable="true");
            document.querySelector('.profile-overlay').style.display='flex';
            document.getElementById('gh-config-btn').style.display='inline-block';
            document.getElementById('add-app-btn').style.display='block';
            document.querySelectorAll('.app-item').forEach(el => {
                el.classList.add('editing');
                el.querySelector('.app-name').contentEditable="true";
                el.querySelector('.app-desc').contentEditable="true";
            });
            document.querySelectorAll('.social-icon').forEach(i => i.classList.add('editing'));
        }

        window.addApp = () => { const name = prompt("Nama Aplikasi:"); if(!name)return; const div = document.createElement('div'); div.className='app-item editing interactive-card'; div.innerHTML = `<h4 class="app-name" contenteditable="true">${name}</h4><p class="app-desc" contenteditable="true">Deskripsi...</p><button class="delete-btn" onclick="this.parentElement.remove()"><i class="fas fa-trash"></i></button><a href="#" class="app-visit-btn" onclick="editLinkAttr(event,this)">Visit</a>`; document.getElementById('apps-list').appendChild(div); if(localStorage.getItem('lumina_perf')!=='true')setup3DInteractions(); };
        window.updateAccent = (c) => { document.documentElement.style.setProperty('--accent-glow', c); localStorage.setItem('lumina_accent', c); document.getElementById('accent-picker').value=c; };
        function initAccentColor() { const c=localStorage.getItem('lumina_accent'); if(c){document.documentElement.style.setProperty('--accent-glow',c);document.getElementById('accent-picker').value=c;}else document.getElementById('accent-picker').value='#38bdf8'; }
        window.editLink=(e,el)=>{if(isEditing){e.preventDefault();const n=prompt("Link:",el.getAttribute('href'));if(n)el.setAttribute('href',n);}};
        window.editLinkAttr=(e,el)=>{if(isEditing){e.preventDefault();const n=prompt("App URL:",el.getAttribute('href'));if(n)el.setAttribute('href',n);}};
        window.configureGithub=()=>{if(isEditing){const n=prompt("Github User:");if(n){localStorage.setItem('gh_user',n);loadGithubData(n);}}};
        window.handleProfileClick=()=>{if(isEditing)openModal('cropper-modal');};
        window.applyCrop=()=>{if(cropper){const canvas=cropper.getCroppedCanvas({width:256,height:256}); const b64=canvas.toDataURL('image/jpeg',0.5); document.getElementById('hero-img').src=b64; closeModal('cropper-modal');}};
        document.getElementById('image-upload').addEventListener('change',e=>{if(e.target.files.length){const r=new FileReader();r.onload=v=>{document.getElementById('image-to-crop').src=v.target.result;if(cropper)cropper.destroy();cropper=new Cropper(document.getElementById('image-to-crop'),{aspectRatio:1,viewMode:1});};r.readAsDataURL(e.target.files[0]);}});
        window.openModal=id=>{document.getElementById(id).classList.add('active');if(id=='login-modal')setTimeout(()=>document.getElementById('pin-input').focus(),100);};
        window.closeModal=id=>{document.getElementById(id).classList.remove('active');};
        
        function initTheme(){ const s=localStorage.getItem('theme'); if(s) document.body.classList.toggle('light-mode', s==='light'); else document.body.classList.toggle('light-mode', themeQuery.matches); }
        window.toggleTheme=()=>{ const isL = document.body.classList.toggle('light-mode'); localStorage.setItem('theme', isL?'light':'dark'); };
        
        window.setPerformanceMode = (isPerf) => {
            if(isPerf) { document.body.classList.add('perf-mode'); localStorage.setItem('lumina_perf','true'); document.getElementById('btn-perf').classList.add('active'); document.getElementById('btn-qual').classList.remove('active'); }
            else { document.body.classList.remove('perf-mode'); localStorage.setItem('lumina_perf','false'); document.getElementById('btn-qual').classList.add('active'); document.getElementById('btn-perf').classList.remove('active'); setup3DInteractions(); }
        }
        function initPerformanceMode() { window.setPerformanceMode(localStorage.getItem('lumina_perf')==='true'); }

        window.splashEffect = () => { const con = document.querySelector('.splash-text'); const txt="Lumina"; con.innerHTML=''; txt.split('').forEach((c,i)=>{ const s=document.createElement('span'); s.innerText=c; s.style.animationDelay=`${i*0.1}s`; con.appendChild(s); }); setTimeout(()=>{ document.getElementById('splash-screen').style.opacity=0; document.getElementById('splash-screen').style.visibility='hidden'; document.body.classList.remove('no-scroll'); }, 4500); };
        function generateQuote() { const idx=Math.floor(Math.random()*quoteDB.length); const q=quoteDB[idx]; document.getElementById('quote-en').innerText=`"${q.en}"`; document.getElementById('quote-id').innerText=q.id?q.id:""; document.getElementById('quote-author').innerText=q.author; }
        window.setupObservers=()=>{ const obs=new IntersectionObserver(es=>es.forEach(e=>{if(e.isIntersecting){e.target.classList.add('show');obs.unobserve(e.target)}})); document.querySelectorAll('.hidden').forEach((e,i)=>{e.style.transitionDelay=i*100+'ms';obs.observe(e);}); };
        window.setup3DInteractions=()=>{ document.querySelectorAll('.interactive-card, .app-item').forEach(card => { card.classList.add('interactive-card'); card.onmousemove=e=>{ if(document.body.classList.contains('perf-mode'))return; const r=card.getBoundingClientRect(); card.style.setProperty('--x',(e.clientX-r.left)+'px'); card.style.setProperty('--y',(e.clientY-r.top)+'px'); card.style.transform=`perspective(1000px) rotateX(${((e.clientY-r.top-r.height/2)/r.height)*-5}deg) rotateY(${((e.clientX-r.left-r.width/2)/r.width)*5}deg) scale(1.02)`; }; card.onmouseleave=()=>card.style.transform='perspective(1000px) rotateX(0) rotateY(0) scale(1)'; }); };
    </script>
</body>
</html>
