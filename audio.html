<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Lumina V55 | Pro Player</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        :root {
            --primary: #fb923c; 
            --bg-grad: linear-gradient(135deg, #fddbb7 0%, #f7ebd9 50%, #dcfce7 100%);
            --txt-prim: #1f1f1f; --txt-sec: #64748b;
            --glass-surf: rgba(255, 255, 255, 0.65);
            --nav-bg: rgba(253, 252, 246, 0.85); --glass: blur(25px);
            --card-bg: #fff;
            --btn-start: #ffe4cc; --btn-text: #9c4221;
        }

        [data-theme="dark"] {
            --bg-grad: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            --txt-prim: #f8fafc; --txt-sec: #94a3b8;
            --nav-bg: rgba(15, 23, 42, 0.85);
            --card-bg: #1e293b;
            --btn-start: #38bdf8; --btn-text: #fff;
            --primary: #38bdf8;
        }

        [data-perf="fast"] { --glass: none; --nav-bg: #fff; --bg-grad: #eee; }

        * { margin:0; padding:0; box-sizing:border-box; outline:none; -webkit-tap-highlight-color:transparent; font-family: 'Plus Jakarta Sans', sans-serif; }
        
        body {
            background: var(--bg-grad); background-attachment: fixed; color: var(--txt-prim);
            min-height: 100vh; display: flex; flex-direction: column; align-items: center; 
            padding-bottom: 140px; transition: 0.5s ease;
        }

        /* NAVBAR & HERO STYLES (Existing) */
        nav {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            background: var(--nav-bg); backdrop-filter: var(--glass);
            padding: 8px 12px 8px 20px; border-radius: 50px;
            display: flex; align-items: center; justify-content: space-between;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05); border: 1px solid rgba(255,255,255,0.4);
            z-index: 100; width: 90%; max-width: 400px; gap: 8px;
        }
        .nav-brand { font-weight: 800; font-size: 1.1rem; cursor: pointer; display: flex; align-items: center; gap: 8px; }
        .nav-link { cursor:pointer; font-weight:600; font-size:0.85rem; color:var(--txt-sec); padding:6px 12px; border-radius:15px; }
        .nav-link.active { color:var(--txt-prim); background:rgba(0,0,0,0.05); }
        .btn-auth { background: #000; color: #fff; padding: 8px 16px; border-radius: 20px; font-size: 0.75rem; font-weight: 700; cursor: pointer; border: none; }
        
        .hero-card { margin-top: 100px; background: var(--card-bg); width: 92%; max-width: 500px; border-radius: 35px; padding: 40px 25px; text-align: center; box-shadow: 0 30px 80px -10px rgba(0,0,0,0.1); }
        
        .av-wrap {
            width: 80px; height: 80px; margin: 0 auto 20px; 
            background: var(--primary); color: #fff;
            border-radius: 50%; font-size: 1.8rem; display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.3s; border: 4px solid #fff; box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .av-wrap.ok { background: #10b981; }

        /* GRID SELECTIONS */
        .grid-mdl { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom:30px }
        .m-card { background: rgba(0,0,0,0.03); border-radius: 20px; padding: 16px; display:flex; gap:10px; align-items:center; cursor:pointer; transition:0.2s; border:2px solid transparent }
        .m-card.active { background: #18181b; border-color: #18181b; color: #fff }
        .m-card.active .ibox { background: #fff; color: #000; }
        .m-card.active * { color: #fff !important; }
        .ibox { width:40px; height:40px; border-radius:12px; display:flex; align-items:center; justify-content:center; background:#fff; color:#333; font-size:1.1rem; flex-shrink:0 }
        
        .btn-go { width: 100%; background: var(--primary); color: #fff; border: 0; padding: 22px; border-radius: 26px; font-size: 1rem; font-weight: 800; cursor: pointer; box-shadow: 0 15px 40px -10px rgba(0,0,0,0.15); transition: 0.2s }
        .btn-go:hover { transform: scale(1.02); filter: brightness(1.1); }

        /* --- THE ULTIMATE PLAYER BAR (CSS UPDATE) --- */
        #wdg {
            position: fixed; bottom: 20px; width: 95%; max-width: 900px;
            /* DARK GLASS THEME MATCHING REFERENCE */
            background: rgba(12, 16, 29, 0.85); 
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            color: #fff; padding: 20px 25px; border-radius: 24px;
            display: none; flex-direction: column; 
            box-shadow: 0 30px 70px rgba(0,0,0,0.6); z-index: 500;
            transition: transform 0.4s cubic-bezier(0.19, 1, 0.22, 1);
        }
        
        /* 1. SEEK BAR (TOP) */
        .wp-progress-container { width: 100%; display:flex; align-items:center; justify-content:space-between; margin-bottom:12px; position:relative; }
        .wp-seek {
            -webkit-appearance: none; width: 100%; height: 4px; border-radius: 5px; 
            background: rgba(255,255,255,0.2); cursor: pointer; position:relative;
        }
        /* Custom progress highlight done via JS gradient, default style */
        .wp-seek::-webkit-slider-thumb { -webkit-appearance: none; width: 0; height: 0; } /* Hide thumb by default like ref, show on hover usually, keeping it minimal here */
        .wp-time { font-size: 0.65rem; color: #94a3b8; position:absolute; top: 10px; width:100%; display:flex; justify-content:space-between; font-weight:600; pointer-events:none}

        /* 2. MAIN LAYOUT GRID */
        .wp-grid { display: flex; align-items: center; justify-content: space-between; gap: 10px; }

        /* LEFT: ART & INFO */
        .wp-left { display: flex; align-items: center; gap: 15px; width: 30%; min-width: 150px; }
        .wp-art { 
            width: 48px; height: 48px; border-radius: 8px; 
            background: #000; overflow:hidden; display:flex; align-items:center; justify-content:center; flex-shrink:0; border:1px solid rgba(255,255,255,0.1);
        }
        .wp-art img { width:100%; height:100%; object-fit:cover; display:none }
        .wp-meta { display: flex; flex-direction: column; overflow: hidden; }
        .wp-tit { font-weight: 700; font-size: 0.95rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color:#fff; }
        .wp-sub { font-size: 0.75rem; color: #94a3b8; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* CENTER: CONTROLS */
        .wp-center { display: flex; align-items: center; justify-content: center; gap: 20px; flex: 1; }
        .bt-sk { background:none; border:none; color:#cbd5e1; font-size:1.1rem; cursor:pointer; transition:0.2s }
        .bt-sk:hover { color:#fff; }
        .bt-play { 
            width: 45px; height: 45px; background: #fff; color: #000; border-radius: 50%; border:none; 
            display:flex; align-items:center; justify-content:center; font-size:1.2rem; cursor:pointer; 
            transition: 0.2s; box-shadow: 0 0 15px rgba(255,255,255,0.2);
        }
        .bt-play:hover { transform: scale(1.05); }

        /* RIGHT: ACTIONS (Download, Queue, Vol) */
        .wp-right { display: flex; align-items: center; justify-content: flex-end; gap: 10px; width: 30%; }
        
        .bt-pill {
            display: flex; align-items: center; gap: 6px; padding: 6px 14px;
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px; color: #fff; font-size: 0.75rem; font-weight: 600;
            text-decoration: none; cursor: pointer; transition: 0.2s;
        }
        .bt-pill:hover { background: rgba(255,255,255,0.15); border-color: rgba(255,255,255,0.3); }
        .bt-pill i { font-size: 0.8rem; }

        /* VOLUME SLIDER */
        .wp-vol-box { display: flex; align-items: center; gap: 8px; margin-left: 10px; }
        .wp-vol-sl { -webkit-appearance: none; width: 70px; height: 3px; background: rgba(255,255,255,0.3); border-radius: 5px; cursor: pointer; }
        .wp-vol-sl::-webkit-slider-thumb { -webkit-appearance: none; width: 10px; height: 10px; border-radius: 50%; background: #fff; cursor: pointer; }

        /* QUEUE LIST FLOATING */
        .wp-queue-panel {
            position: absolute; bottom: 110%; right: 0; width: 300px;
            background: rgba(12, 16, 29, 0.95); backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1); border-radius: 16px;
            padding: 10px; max-height: 250px; overflow-y: auto; display: none;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        .q-item { padding: 10px; border-radius: 8px; display:flex; justify-content:space-between; align-items:center; cursor:pointer; color:#ccc; font-size:0.85rem }
        .q-item:hover { background: rgba(255,255,255,0.1); color:#fff; }
        .q-item.now { color: var(--primary); background: rgba(255,255,255,0.05); }

        /* RESPONSIVE BAR */
        @media (max-width: 768px) {
            #wdg { flex-direction: column; padding: 15px; }
            .wp-grid { flex-wrap: wrap; justify-content: center; }
            .wp-left { width: 100%; justify-content: flex-start; margin-bottom: 10px; }
            .wp-right { width: 100%; justify-content: space-around; margin-top: 10px; }
            .wp-queue-panel { width: 100%; }
        }

        /* Animation Spin */
        .spn { animation: spin 1s infinite linear; } @keyframes spin{to{transform:rotate(360deg)}}
        .ovl { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); backdrop-filter:blur(8px); z-index:300; display:none; justify-content:center; align-items:center }
    </style>
</head>
<body>

    <nav>
        <div class="nav-brand" onclick="location.href='https://lumina-omega-five.vercel.app/'">
            <i class="fas fa-chevron-left"></i> <span>Lumina</span>
        </div>
        <div class="nav-mid">
            <span class="nav-link active">Studio</span>
            <span class="nav-link" onclick="openH()">History</span>
        </div>
        <div class="nav-user">
            <img src="" id="u-img" class="user-pic" onclick="document.getElementById('user-modal').style.display='flex'">
            <button id="btn-login" class="btn-auth" onclick="authL()">Login</button>
        </div>
    </nav>

    <!-- PRO PLAYER BAR -->
    <div id="wdg">
        <!-- SEEK BAR ROW -->
        <div class="wp-progress-container">
            <input type="range" class="wp-seek" id="seek" value="0" step="0.1" oninput="seekAu(this.value)">
            <div class="wp-time">
                <span id="t-cur">0:00</span>
                <span id="t-dur">0:00</span>
            </div>
        </div>

        <!-- CONTROL GRID -->
        <div class="wp-grid">
            
            <!-- LEFT INFO -->
            <div class="wp-left">
                <div class="wp-art">
                    <i class="fas fa-music" id="wa-ic" style="color:#64748b; font-size:1.2rem"></i>
                    <img id="wa-img"> <!-- Placeholder for future -->
                    <div id="wa-spin" style="width:20px;height:20px;border:2px solid #555;border-top-color:#fff;border-radius:50%;display:none" class="spn"></div>
                </div>
                <div class="wp-meta">
                    <div class="wp-tit" id="wt">Uploading...</div>
                    <div class="wp-sub" id="ws">Wait</div>
                </div>
            </div>

            <!-- CENTER CONTROLS -->
            <div class="wp-center">
                <button class="bt-sk" onclick="prv()"><i class="fas fa-backward-step"></i></button>
                <button class="bt-play" onclick="togP()">
                    <i class="fas fa-play" id="ic-p" style="margin-left:3px"></i>
                </button>
                <button class="bt-sk" onclick="nxt()"><i class="fas fa-forward-step"></i></button>
            </div>

            <!-- RIGHT ACTIONS -->
            <div class="wp-right">
                <a id="btn-dl" class="bt-pill" href="#" download>
                    <i class="fas fa-download"></i> <span style="font-size:0.7rem">Save</span>
                </a>
                
                <div class="bt-pill" onclick="togQ()">
                    <i class="fas fa-list"></i>
                </div>

                <div class="wp-vol-box">
                    <i class="fas fa-volume-high" style="font-size:0.8rem; color:#94a3b8"></i>
                    <input type="range" class="wp-vol-sl" min="0" max="1" step="0.1" oninput="setVol(this.value)">
                </div>
            </div>
        </div>

        <!-- POPUP QUEUE -->
        <div class="wp-queue-panel" id="q-box"></div>
    </div>

    <!-- MAIN UI (Hero) -->
    <div class="hero-card">
        <div class="av-wrap" onclick="document.getElementById('f').click()">
            <input type="file" id="f" hidden accept="audio/*">
            <i class="fas fa-cloud-upload-alt" id="ico"></i>
        </div>
        <h1 style="margin-bottom:5px;font-size:1.8rem;color:var(--txt-prim)">Studio</h1>
        <div style="margin-bottom:30px;color:var(--txt-sec);font-size:0.9rem">Upload audio to split</div>

        <div class="inp-pill">
            <input id="api" placeholder="Cloudflare Link...">
            <button onclick="cn(this)">Connect</button>
        </div>
        <a href="https://colab.research.google.com/drive/1tw8nJdGokvMY4gMmQ8m3hOG8j0zYK5CV#scrollTo=jswAJ-NK2Aja" target="_blank" style="display:block;margin-bottom:30px;color:var(--txt-sec);text-decoration:none;font-size:0.75rem;border-bottom:1px dashed #ccc;width:fit-content;margin:0 auto 30px auto">Script Colab &nearr;</a>

        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:20px; text-align:left">
            <div class="m-card active" onclick="sm('inst_v1e_plus',this)">
                <div class="ibox"><i class="fas fa-wave-square"></i></div>
                <div><div style="font-weight:700;font-size:0.8rem;color:var(--txt-prim)">MelBand+</div><div style="font-size:0.6rem;color:var(--txt-sec)">High Quality</div></div>
            </div>
            <div class="m-card" onclick="sm('Resurrection-Inst',this)">
                <div class="ibox"><i class="fas fa-star"></i></div>
                <div><div style="font-weight:700;font-size:0.8rem;color:var(--txt-prim)">ViperX</div><div style="font-size:0.6rem;color:var(--txt-sec)">Classic</div></div>
            </div>
            <div class="m-card" onclick="sm('Resurrection-v',this)">
                <div class="ibox"><i class="fas fa-microphone"></i></div>
                <div><div style="font-weight:700;font-size:0.8rem;color:var(--txt-prim)">Resur Vocal</div><div style="font-size:0.6rem;color:var(--txt-sec)">Clean Vocals</div></div>
            </div>
            <div class="m-card" onclick="sm('Kim_Vocal_2',this)">
                <div class="ibox"><i class="fas fa-bolt"></i></div>
                <div><div style="font-weight:700;font-size:0.8rem;color:var(--txt-prim)">Kim Voc</div><div style="font-size:0.6rem;color:var(--txt-sec)">Fast Mode</div></div>
            </div>
        </div>

        <button class="btn-go" onclick="run()">START SEPARATION</button>
    </div>

    <!-- UTILS -->
    <audio id="au" ontimeupdate="upP()"></audio>
    <div id="hist-modal" class="ovl" onclick="if(event.target==this)this.style.display='none'">
        <div style="background:var(--card-bg);width:340px;padding:20px;border-radius:20px">
            <div style="display:flex;justify-content:space-between;margin-bottom:15px"><h3 style="margin:0;color:var(--txt-prim)">History</h3><button onclick="openH(false)" style="border:none;background:none;font-size:1.5rem">&times;</button></div>
            <div id="h-con" style="max-height:300px;overflow:auto"></div>
        </div>
    </div>
    
    <!-- User Modal -->
    <div id="user-modal" class="ovl" onclick="if(event.target==this)this.style.display='none'">
        <div style="background:var(--card-bg);width:300px;padding:30px;border-radius:20px;text-align:center">
            <img id="p-img" style="width:80px;height:80px;border-radius:50%;margin-bottom:10px">
            <h3 id="p-nm" style="margin:0;color:var(--txt-prim)">User</h3>
            <p id="p-em" style="font-size:0.8rem;color:var(--txt-sec)">email</p>
            <button onclick="authOut()" style="margin-top:20px;padding:10px 20px;background:#fecaca;color:#ef4444;border:none;border-radius:10px;font-weight:700">Logout</button>
        </div>
    </div>

    <!-- LOGIC -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        const firebaseConfig = {
        apiKey: "AIzaSyDkSwr7n2niyN5MFzr6LMOIv-4Vpqa9LlY",
        authDomain: "studio-7547085914-216a7.firebaseapp.com",
        projectId: "studio-7547085914-216a7",
        storageBucket: "studio-7547085914-216a7.firebasestorage.app",
        messagingSenderId: "1014659160462",
        appId: "1:1014659160462:web:d9bb29344e36ab031bacdf"
        };
        
        try { 
            const app=initializeApp(firebaseConfig); const auth=getAuth(app); const db=getFirestore(app);
            onAuthStateChanged(auth, u=>{ 
                window.curU = u; window.db = db;
                if(u){ document.getElementById('u-img').src=u.photoURL; document.getElementById('u-img').style.display='block'; document.getElementById('btn-login').style.display='none'; 
                       document.getElementById('p-img').src=u.photoURL; document.getElementById('p-nm').innerText=u.displayName; document.getElementById('p-em').innerText=u.email; window.syH(); }
                else { document.getElementById('btn-login').style.display='block'; document.getElementById('u-img').style.display='none'; }
            });
            window.authL=async()=>{await signInWithPopup(auth,new GoogleAuthProvider())}; window.authOut=()=>signOut(auth);
            
            window.svH = async (f,d) => {
                if(curU) { try{await addDoc(collection(db,"h"),{u:curU.uid,f:f,d:d,t:Date.now()}); syH();}catch(e){} }
                let l=JSON.parse(localStorage.getItem('LH')||"[]"); l.unshift({f:f,d:d,t:Date.now()}); localStorage.setItem('LH',JSON.stringify(l));
            }
            window.syH = async () => {
                if(!curU) return loadLoc();
                const q=query(collection(db,"h"),where("u","==",curU.uid)); const s=await getDocs(q);
                if(s.empty) return loadLoc();
                let a=[]; s.forEach(d=>a.push(d.data())); a.sort((x,y)=>y.t-x.t); rendH(a);
            }
        } catch(e){}
    </script>

    <script>
        let B=localStorage.getItem('API')||"", M='inst_v1e_plus', F=null;
        let AU=document.getElementById('au'), Q=[], IDX=0;

        window.onload=()=>{
            if(B) document.getElementById('api').value=B;
            document.getElementById('f').onchange=e=>{if(e.target.files[0]){F=e.target.files[0];document.getElementById('st-sub').innerText=F.name;document.getElementById('ico').className="fas fa-check";document.querySelector('.av-wrap').classList.add('ok')}};
            AU.onended=nxt;
        }

        // --- NEW TITLE CLEANER ---
        function cleanT(s) {
            let n = s.substring(s.indexOf('_')+1); 
            n = n.replace(/(_?model_?|mel_band|roformer|bs_roformer|kim_vocal).*/gi, ""); 
            n = n.replace(/\.(mp3|wav|flac)$/i, "").replace(/_/g, " ");
            return n.length<3 ? "Result Audio" : n;
        }

        // --- PLAYER FUNCTIONS ---
        function openP(s){
            let p=document.getElementById('wdg'); p.style.display='flex';
            if(s) { 
                document.getElementById('wa-ic').style.display='none'; document.getElementById('wa-spin').style.display='block';
                document.getElementById('wt').innerText="Processing...";
                document.getElementById('w-ctr-area').style.opacity='0.5';
            } else {
                document.getElementById('wa-ic').style.display='block'; document.getElementById('wa-spin').style.display='none';
                document.getElementById('w-ctr-area').style.opacity='1';
            }
        }

        function doneP(dt){
            Q=[]; let keys=Object.keys(dt).sort((a,b)=>a.includes('vocal')?-1:1);
            let h="";
            keys.forEach((k,i)=>{
                let u=B+dt[k], ty=k.toLowerCase().includes('vocal')?'Vocals':'Instru', nm=cleanT(k);
                Q.push({t:nm,s:ty,u:u});
                h+=`<div class="q-item ${i==0?'now':''}" onclick="playQ(${i})"><div><b>${nm}</b> <span style="font-size:0.7rem;color:#888">${ty}</span></div><i class="fas fa-play" style="font-size:0.8rem"></i></div>`;
            });
            document.getElementById('q-box').innerHTML=h;
            openP(false); playQ(0);
        }

        function playQ(i){
            IDX=i; AU.src=Q[i].u; 
            document.getElementById('wt').innerText = Q[i].t;
            document.getElementById('ws').innerText = Q[i].s;
            document.getElementById('btn-dl').href = Q[i].u;
            // Update UI Queue Highlight
            let qs=document.querySelectorAll('.q-item'); qs.forEach(x=>x.classList.remove('now'));
            if(qs[i]) qs[i].classList.add('now');
            
            togP(true);
        }

        function togP(force){ 
            if(force||AU.paused){ AU.play(); document.getElementById('ic-p').className='fas fa-pause'; }
            else { AU.pause(); document.getElementById('ic-p').className='fas fa-play'; }
        }
        function nxt(){ if(IDX<Q.length-1)playQ(IDX+1); } function prv(){ if(IDX>0)playQ(IDX-1); }
        function togQ(){ let b=document.getElementById('q-box'); b.style.display=b.style.display=='block'?'none':'block'; }
        function setVol(v){ AU.volume=v; }
        function seekAu(v){ AU.currentTime=(v/100)*AU.duration; }
        function upP(){
            document.getElementById('seek').value=(AU.currentTime/AU.duration)*100||0;
            document.getElementById('t-cur').innerText=fmt(AU.currentTime);
            document.getElementById('t-dur').innerText=fmt(AU.duration);
            // Gradient fill effect on seek bar
            let val = document.getElementById('seek').value;
            document.getElementById('seek').style.background = `linear-gradient(to right, #fff ${val}%, rgba(255,255,255,0.2) ${val}%)`;
        }
        function fmt(s){if(!s)return "0:00"; let m=Math.floor(s/60),sc=Math.floor(s%60); return m+":"+(sc<10?'0':'')+sc;}

        // CORE LOGIC
        function loadLoc(){ 
            let l=JSON.parse(localStorage.getItem('LH')||"[]"); rendH(l); 
        }
        function rendH(arr){
            let h=""; arr.forEach(x=>{
                let ls=""; Object.keys(x.d).forEach(k=>ls+=`<a href="${B+x.d[k]}" target="_blank" style="margin-left:5px;font-size:0.7rem;text-decoration:none;color:var(--primary)">${k.substring(0,6)}..</a>`);
                h+=`<div style="padding:10px 0;border-bottom:1px solid #eee"><b>${x.f}</b><div style="font-size:0.7rem;color:#999">${new Date(x.t).toLocaleDateString()} ${ls}</div></div>`;
            });
            document.getElementById('h-con').innerHTML=h||"No history.";
        }
        function openH(x){ document.getElementById('hist-modal').style.display=x===false?'none':'flex'; if(x!==false)window.syH?window.syH():loadLoc(); }
        function sm(m,e){ M=m; document.querySelectorAll('.m-card').forEach(x=>x.classList.remove('active')); e.classList.add('active'); }
        async function cn(b){
            let v=document.getElementById('api').value.replace(/\/$/,""); b.innerText="...";
            try{let r=await fetch(v+'/ping');if(r.ok){B=v;localStorage.setItem('API',v);b.innerText="OK";} else throw 1}catch{if(confirm("Fail. Open?"))window.open(v);b.innerText="Link";}
        }
        function run(){
            if(!B||!F)return alert("Check");
            openP(true);
            let fd=new FormData(); fd.append('audio_file',F); fd.append('model_name',M);
            let x=new XMLHttpRequest(); x.onload=()=>{ if(x.status==200) mon(JSON.parse(x.responseText).task_id); }; x.open('POST',B+'/upload_job'); x.send(fd);
        }
        async function mon(id){
            let iv=setInterval(async()=>{
                try{
                    let r=await fetch(B+'/check_job/'+id); let d=await r.json();
                    document.getElementById('ws').innerText=d.message||"Running...";
                    if(d.status=='done'){ clearInterval(iv); doneP(d.data); if(window.svH) window.svH(F.name, d.data); }
                }catch{}
            },2000);
        }
    </script>
</body>
</html>
